import{d as U,r as v,p as l,a as f,q as g,F as $,s as I,y as a,E as T,U as N,k as S,z as C,X as D,v as n,R,_ as x,S as z}from"./index-D0q4Tvfn.js";import{T as E,a as F}from"./index-DWnlEZ0M.js";import"./index-DSXW9EQB.js";import{N as G}from"./index-BSsxpHD2.js";import{P}from"./index-Dy-YdUL9.js";import{L as q}from"./index-CQ0AcZxS.js";import"./use-id-BKPegcpj.js";import"./use-route-DBmi_S5x.js";import"./use-placeholder-DjYg9uGk.js";const A="/static/img/1.png",X={class:"msg-space"},j=["onClick"],H={class:"badge-box"},J={class:"item-medi"},K={class:"nickname"},O={class:"info"},Q={key:0},W={key:1},Y={class:"time"},Z={class:"item-right"},ee=["src"],te=U({__name:"MsgComp",props:{active:{}},setup(B){const c=v(!1),i=v(!1),_=v(!1),d=v([]),r=B,m=async()=>{let e="";r.active==0?e="/api/notifications/unread":r.active==1?e="/api/video/episode/my-unread-replies":r.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(d.value.length/20)+1;try{const o=await R.get(e,{params:{page:s,size:20}}),u=o.data.data.list||o.data.list;d.value.push(...u),u.length<20&&(i.value=!0)}catch(o){console.error(o)}},h=async()=>{await m(),i.value=!0},y=async()=>{d.value=[],i.value=!1,await m(),_.value=!1},w=e=>{const s=new Date(e),u=new Date().getTime()-s.getTime(),M=Math.floor(u/1e3),t=Math.floor(M/60),k=Math.floor(t/60),V=Math.floor(k/24);return V>0?`${V}天前`:k>0?`${k}小时前`:t>0?`${t}分钟前`:"刚刚"},b=async e=>{const s="/api/video/episode/replies/mark-read";try{await R.post(s,{replyIds:[e]})}catch(o){console.error(o)}},p=async e=>{const s="/api/video/comment/likes/mark-read";try{await R.post(s,{replyIds:[e]})}catch(o){console.error(o)}},L=async e=>{r.active==1||e.type=="reply"?await b(e.id):(r.active==2||e.type=="like")&&await p(e.id),e.isRead=!0,D.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const o=S,u=q,M=P;return n(),l("div",X,[f(M,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),onRefresh:y},{default:g(()=>[f(u,{loading:c.value,"onUpdate:loading":s[0]||(s[0]=t=>c.value=t),finished:i.value,"finished-text":"没有更多了",onLoad:h},{default:g(()=>[(n(!0),l($,null,I(d.value,t=>(n(),l("div",{class:"msg-item",key:t.id,onClick:k=>L(t)},[a("div",H,[t.isRead?N("",!0):(n(),T(o,{key:0,dot:""}))]),s[4]||(s[4]=a("div",{class:"item-left"},[a("img",{src:A,alt:""})],-1)),a("div",J,[a("div",K,C(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),a("div",O,[e.active==1||t.type=="reply"?(n(),l("div",Q,[s[2]||(s[2]=a("span",null,"评论了你:",-1)),a("span",null,C(t.content),1)])):e.active==2||t.type=="like"?(n(),l("div",W,s[3]||(s[3]=[a("span",null,"点赞了你的评论",-1)]))):N("",!0),a("span",Y,C(w(t.createdAt)),1)])]),a("div",Z,[a("img",{src:t.seriesCoverUrl,alt:""},null,8,ee)])],8,j))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}}),se=x(te,[["__scopeId","data-v-547eedfa"]]),ae=U({__name:"MessageView",setup(B){const c=z(),i=v(0),_=v(["全部","评论","点赞"]),d=()=>{r()},r=()=>{c.options.history.state?.back!==null?c.back():c.push("/")};return(m,h)=>{const y=G,w=F,b=E;return n(),l("div",null,[f(y,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:d}),f(b,{active:i.value,"onUpdate:active":h[0]||(h[0]=p=>i.value=p),shrink:"","line-width":"3vw",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:g(()=>[(n(!0),l($,null,I(_.value,p=>(n(),T(w,{title:p,key:p},{default:g(()=>[f(se,{active:i.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),ve=x(ae,[["__scopeId","data-v-9b6106ca"]]);export{ve as default};
