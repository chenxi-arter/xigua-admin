import{d as L,N as j,r as u,O as q,o as K,P as W,p as k,q as _,a as l,y as n,s as t,I as $,l as N,af as Q,ag as O,ah as D,z as U,S as C,a2 as ee,F as ae,ae as r,U as y,ab as le,_ as oe}from"./index-_5rAYpry.js";import{C as te}from"./index-DXc7RUGu.js";import{F as se}from"./index-CDvGFLhm.js";import{C as re}from"./index-DJryRXYI.js";import{N as ne}from"./index-DFIZXtej.js";import{B as ie}from"./index-DEO0VS8-.js";import"./use-route-CLu1Ug9Z.js";import"./use-id-CzLRy-nw.js";import"./use-placeholder-Bk9d9jTs.js";const ue={class:"overflow_y-auto"},ce={style:{margin:"0.5rem 0.5rem"}},me={class:"content-wrap"},de={key:0,class:"content-wrap"},pe={key:1,class:"content-wrap"},ve=L({__name:"AccountSecurityView",setup(ge){const V=j(),g=u(!1),m=u(!1),b=u(""),f=u(""),i=u(""),c=u(""),A=u(""),E=u(""),x=q(),R=K(),o=u({email:"",nickname:"",username:"",firstName:"",lastName:"",hasTelegram:!1,isActive:!1,createdAt:"",photoUrl:"",tgusername:""}),T=async()=>{try{const a=await y.get("/api/user/me");o.value=a.data}catch(a){console.error(a)}};W(async()=>{await T()});const z=()=>{V.push("/settings")},I=a=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(a),G=async()=>{try{await navigator.clipboard.writeText(o.value.username),r("已复制到剪切板")}catch(a){r("复制失败"),console.error(a)}},M=async()=>{const a=le();try{await a.logout(),R.stop(),V.push("/")}catch(e){console.error("logout error: ",e)}},P=async()=>{const a={nickname:b.value};try{const e=await y.post("/api/user/update-nickname",a);e.data.success?(r("昵称修改成功"),g.value=!1,await T()):r(e.data.message)}catch(e){console.error("click_nickname:",e)}},X=async()=>{const a={oldPassword:A.value,newPassword:i.value,confirmPassword:c.value};try{const e=await y.post("/api/user/update-password",a);return e.data.success?(r("密码修改成功"),!1):(r(e.data.message),!0)}catch(e){return console.error("change_password:",e),!0}},Y=async()=>{if(!I(f.value))return r("邮箱格式不正确"),!0;const a={email:f.value,password:i.value,confirmPassword:c.value};try{const e=await y.post("/api/user/bind-email",a);return e.data.success?(r("邮箱绑定成功"),await T(),!1):(r(e.data.message),!0)}catch(e){return console.error("bind_account:",e),!0}},S=async()=>{let a=!0;if(i.value.length<6||i.value.length>20){r("密码长度必须在 6-20 位");return}if(i.value!==c.value){r("两次密码输入不一致");return}o.value.email?a=await X():a=await Y(),m.value=a},F=(a,e)=>{y.post(e,a).then(d=>{d.data.access_token?(V.replace("/info"),r("telegram 绑定成功")):r("telegram 绑定失败")}).catch(d=>{console.error("toLogin error: ",d)})},Z=()=>{if(window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData)E.value=window.Telegram.WebApp.initData||"",F({initData:E.value},"/api/auth/telegram/webapp-login");else{const a=location.origin,e="8326325358";window.location.href=`https://oauth.telegram.org/auth?bot_id=${e}&origin=${a}/info`}};function J(a){a=a.replace(/-/g,"+").replace(/_/g,"/");const e=a.length%4;e&&(a+="=".repeat(4-e));const d=Uint8Array.from(atob(a),p=>p.charCodeAt(0));return new TextDecoder().decode(d)}if(x.hash.includes("tgAuthResult")){const a=x.hash.replace("#tgAuthResult=",""),e=JSON.parse(J(a));F(e,"/api/auth/telegram/bot-login")}return(a,e)=>{const d=ne,p=te,B=$,w=re,h=ie,v=se,H=ee;return _(),k(ae,null,[l(d,{title:"账号与安全","left-arrow":"",class:"relative nav-bar",style:{color:"aliceblue"},onClickLeft:z},{left:t(()=>e[13]||(e[13]=[n("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"",class:"left-arrow"},null,-1)])),right:t(()=>e[14]||(e[14]=[])),_:1}),n("div",ue,[l(w,{style:{width:"93%",margin:"0.3rem auto"}},{default:t(()=>[l(p,{class:"van-cell-line",title:"ID",icon:"user-o",value:o.value.username},{"right-icon":t(()=>[(_(),k("svg",{onClick:G,class:"svg-icon",style:{"margin-left":"0.3rem",width:"1em",height:"1em","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},e[15]||(e[15]=[n("path",{d:"M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z"},null,-1)])))]),_:1},8,["value"]),l(p,{class:"van-cell-line",title:"昵称",icon:"smile-o",value:o.value.nickname},{"right-icon":t(()=>[l(B,{onClick:e[0]||(e[0]=()=>{g.value=!g.value}),name:"edit",style:{"margin-left":"0.3rem"}})]),_:1},8,["value"])]),_:1}),l(w,{style:{width:"93%",margin:"0.3rem auto"}},{default:t(()=>[l(p,N({class:"van-cell-line",title:"邮箱",icon:"envelop-o","is-link":!o.value.email},Q(o.value.email?{}:{click:()=>{m.value=!m.value}})),O({value:t(()=>[n("span",{style:D({color:o.value.email?"":"#FF7875"})},U(o.value.email||"未设置"),5)]),_:2},[o.value.email?{name:"right-icon",fn:t(()=>[l(B,{name:"certificate",style:{"margin-left":"0.3rem"}})]),key:"0"}:void 0]),1040,["is-link"]),l(p,{class:"van-cell-line",title:"密码",icon:"lock","is-link":"",onClick:e[1]||(e[1]=()=>{m.value=!m.value})},{value:t(()=>[n("span",{style:D({color:o.value.email?"":"#FF7875"})},U(o.value.email?"修改":"未设置"),5)]),_:1}),l(p,N({class:"van-cell-line",title:"Telegram","is-link":!o.value.hasTelegram,icon:"guide-o"},Q(o.value.hasTelegram?{}:{click:Z})),O({value:t(()=>[n("span",{style:D({color:o.value.hasTelegram?"":"#FF7875"})},U(o.value.hasTelegram?o.value.tgusername:"未设置"),5)]),_:2},[o.value.hasTelegram?{name:"right-icon",fn:t(()=>[l(B,{name:"certificate",style:{"margin-left":"0.3rem"}})]),key:"0"}:void 0]),1040,["is-link"])]),_:1}),n("div",ce,[l(h,{block:"",class:"logout",type:"primary",onClick:M},{default:t(()=>e[16]||(e[16]=[C(" 退出登录 ")])),_:1,__:[16]})])]),l(H,{"close-icon":"clear",show:g.value,"onUpdate:show":e[3]||(e[3]=s=>g.value=s),closeable:"",style:{padding:"0.3rem","border-radius":"0.2rem","background-color":"#1c1c1b"},onOpen:e[4]||(e[4]=()=>{b.value=o.value.nickname})},{default:t(()=>[n("div",me,[e[18]||(e[18]=n("div",{class:"title"},"昵称修改",-1)),l(w,{style:{margin:"0.4rem 0"}},{default:t(()=>[l(v,{"label-width":"1rem",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),clearable:"","left-icon":"smile-o",label:"昵称","input-align":"left",placeholder:"请输入昵称",style:{"border-radius":"0.1rem"}},null,8,["modelValue"])]),_:1}),l(h,{block:"",class:"custom-btn",type:"primary",onClick:P},{default:t(()=>e[17]||(e[17]=[C(" 确认 ")])),_:1,__:[17]})])]),_:1},8,["show"]),l(H,{"close-icon":"clear",show:m.value,"onUpdate:show":e[11]||(e[11]=s=>m.value=s),closeable:"",style:{padding:"0.3rem","border-radius":"0.2rem","background-color":"#1c1c1b"},onClose:e[12]||(e[12]=()=>{i.value="",c.value="",f.value="",A.value=""})},{default:t(()=>[o.value.email?(_(),k("div",de,[e[20]||(e[20]=n("div",{class:"title"},"密码修改",-1)),l(w,{style:{margin:"0.4rem 0"}},{default:t(()=>[l(v,{"label-width":"1rem",modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=s=>A.value=s),"left-icon":"lock",label:"旧",placeholder:"请输入当前密码",style:{"border-radius":"0.1rem"},type:"password"},null,8,["modelValue"]),l(v,{"label-width":"1rem",modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=s=>i.value=s),"left-icon":"lock",label:"新",placeholder:"请输入新密码",style:{"border-radius":"0.1rem"},type:"password"},null,8,["modelValue"]),l(v,{"label-width":"1rem",modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=s=>c.value=s),"left-icon":"lock",label:"新",placeholder:"请再次输入密码",style:{"border-radius":"0.1rem"},type:"password"},null,8,["modelValue"])]),_:1}),l(h,{block:"",class:"custom-btn",type:"primary",onClick:S},{default:t(()=>e[19]||(e[19]=[C(" 确认 ")])),_:1,__:[19]})])):(_(),k("div",pe,[e[22]||(e[22]=n("div",{class:"title"},"绑定邮箱（注册账号）",-1)),l(w,{style:{margin:"0.4rem 0"}},{default:t(()=>[l(v,{"label-width":"1rem",modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),"left-icon":"envelop-o",label:"邮箱",placeholder:"请输入邮箱",style:{"border-radius":"0.1rem"},type:"email"},null,8,["modelValue"]),l(v,{"label-width":"1rem",modelValue:i.value,"onUpdate:modelValue":e[9]||(e[9]=s=>i.value=s),"left-icon":"lock",label:"密码",placeholder:"请输入新密码",style:{"border-radius":"0.1rem"},type:"password"},null,8,["modelValue"]),l(v,{"label-width":"1rem",modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=s=>c.value=s),"left-icon":"lock",label:"密码",placeholder:"请再次输入密码",style:{"border-radius":"0.1rem"},type:"password"},null,8,["modelValue"])]),_:1}),l(h,{block:"",class:"custom-btn",type:"primary",onClick:S},{default:t(()=>e[21]||(e[21]=[C(" 确认 ")])),_:1,__:[21]})]))]),_:1},8,["show"])],64)}}}),Ve=oe(ve,[["__scopeId","data-v-6c095e51"]]);export{Ve as default};
