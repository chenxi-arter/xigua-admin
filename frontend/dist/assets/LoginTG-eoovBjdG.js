import{d as D,r as m,O as E,N as M,o as Q,ab as h,Q as R,A as G,p as v,q as _,y as t,a as n,s as i,S as A,ae as b,U as O,_ as H}from"./index-B5bK_e6X.js";import{C as N}from"./index-3_I6tS_o.js";import"./index-BIGHy_C0.js";import{F as U}from"./index-7CMoYmHh.js";import{_ as V,F as X}from"./logo2-rinVvwJo.js";import{B as F}from"./index-Cse8uYzf.js";import"./use-route-7R4tdDFL.js";import"./use-id-Bbu2fwFq.js";const L={class:"login"},Y={class:"login-container"},j={style:{display:"flex","justify-content":"space-between"}},z={style:{margin:"0.37rem 0"}},J=D({__name:"LoginTG",setup(Z){const d=m(""),l=m(""),c=E(),g=M(),f=m("");function y(o){o=o.replace(/-/g,"+").replace(/_/g,"/");const e=o.length%4;e&&(o+="=".repeat(4-e));const a=Uint8Array.from(atob(o),s=>s.charCodeAt(0));return new TextDecoder().decode(a)}const k=async()=>{const o=localStorage.getItem("campaignCode"),e=sessionStorage.getItem("sessionId"),a=localStorage.getItem("deviceId");if(o&&a&&e)try{await O.post("/api/tracking/advertising/conversion",{campaignCode:o,conversionType:"register",sessionId:e,deviceId:a})}catch(s){console.error(s)}},C=Q(),w=h(),p=async(o,e)=>{if(await w.login(o,e)){const s=c.query.redirect,r=Array.isArray(s)?s[0]:s||"/";g.replace(r),k(),C.start()}else b("登录失败")},x=()=>{if(l.value.length<6||l.value.length>20){b("密码长度必须在 6-20 位");return}const o={email:d.value,password:l.value,guestToken:w.guestToken||""};p(o,"/api/auth/email-login")},B=()=>{if(window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData){f.value=window.Telegram.WebApp.initData||"";const o=h();p({initData:f.value,guestToken:o.guestToken||""},"/api/auth/telegram/webapp-login")}else{const o=location.origin,e="8326325358";window.location.href=`https://oauth.telegram.org/auth?bot_id=${e}&origin=${o}/login`}};if(c.hash.includes("tgAuthResult")){const o=c.hash.replace("#tgAuthResult=",""),e=JSON.parse(y(o));p(e,"/api/auth/telegram/bot-login")}const T=()=>{window.history.state?.back?g.back():g.push("/")};return R(()=>{window.Telegram&&window.Telegram.WebApp&&localStorage.getItem("Authorization")}),(o,e)=>{const a=U,s=N,r=G("router-link"),I=F,S=X;return _(),v("div",L,[t("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"返回",class:"left-arrow",onClick:T}),t("div",Y,[e[9]||(e[9]=t("div",{class:"logo-section"},[t("img",{src:V,alt:"Logo",class:"logo"})],-1)),n(S,{onSubmit:x},{default:i(()=>[n(s,{inset:"",class:"form-group"},{default:i(()=>[n(a,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=u=>d.value=u),type:"email",placeholder:"请输入邮箱","label-width":"0.5rem",class:"input-field"},{label:i(()=>e[2]||(e[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.5rem",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4z"}),t("path",{d:"M12 14c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})],-1)])),_:1},8,["modelValue"])]),_:1}),n(s,{inset:"",class:"form-group"},{default:i(()=>[n(a,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value=u),type:"password",placeholder:"请输入密码","show-message":!1,class:"input-field","label-width":"0.5rem"},{label:i(()=>e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.5rem",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),t("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])),_:1},8,["modelValue"])]),_:1}),t("div",j,[n(r,{to:{name:"register"},class:"link"},{default:i(()=>e[4]||(e[4]=[A("立即注册")])),_:1,__:[4]}),n(r,{to:"",class:"link"},{default:i(()=>e[5]||(e[5]=[A("忘记密码")])),_:1,__:[5]})]),t("div",z,[n(I,{block:"",type:"primary","native-type":"submit",style:{height:"1.1rem"}},{default:i(()=>e[6]||(e[6]=[A(" 登录 ")])),_:1,__:[6]})]),e[8]||(e[8]=t("div",{class:"divider"},"快速登录",-1)),(_(),v("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 80 80",class:"tg-icon",onClick:B},e[7]||(e[7]=[t("g",{"clip-path":"url(#i389236776__a)"},[t("ellipse",{cx:"39.5",cy:"39.5",fill:"#fff",rx:"31.5",ry:"30.5"}),t("path",{fill:"#1296DB",d:"m53.08 58.349 6.563-30.938c.58-2.722-.983-3.794-2.769-3.125L18.303 39.15c-2.635 1.026-2.589 2.5-.446 3.169l9.866 3.08 22.903-14.42c1.071-.714 2.054-.311 1.251.403l-18.526 16.74-.714 10.18c1.026 0 1.474-.446 2.009-.983l4.82-4.643 10 7.366c1.831 1.026 3.126.491 3.617-1.697l-.003.003ZM80 40c0 22.097-17.903 40-40 40S0 62.097 0 40 17.903 0 40 0s40 17.903 40 40Z"})],-1),t("defs",null,[t("clipPath",{id:"i389236776__a"},[t("path",{fill:"#fff",d:"M0 0h80v80H0z"})])],-1)])))]),_:1,__:[8]})])])}}}),se=H(J,[["__scopeId","data-v-a52bd1f5"]]);export{se as default};
