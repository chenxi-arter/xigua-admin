import{d as B,r as u,b as r,c as v,w as g,F as N,e as $,f as o,t as M,y as U,A as L,o as n,_ as T,j as x,s as I}from"./index-DRDzriRK.js";import{T as R,a as S}from"./index-CLLWzp2C.js";import"./index-BjpyG2e1.js";import{N as D}from"./index-CWnIF4Ic.js";import{P as A}from"./index-86oxSSEN.js";import{L as F}from"./index-B6oVjb0Z.js";import{s as G}from"./request-BuSNsvZ_.js";import"./index-8oRCbgwB.js";import"./use-id-cELM-EVO.js";import"./index-Byqqjexg.js";import"./use-route-Dj_hs6yx.js";import"./use-placeholder-CANW0rqT.js";const P="/static/img/1.png",j={class:"msg-space"},z=["onClick"],E={class:"item-medi"},q={class:"nickname"},H={class:"info"},J={key:0},K={key:1},O={class:"time"},Q={class:"item-right"},W=["src"],X=B({__name:"MsgComp",props:{active:{}},setup(C){const l=u(!1),a=u(!1),p=u(!1),c=u([]),m=C,f=async()=>{let e="";m.active==0?e="/api/notifications/unread":m.active==1?e="/api/video/episode/my-unread-replies":m.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(c.value.length/20)+1;try{const i=await G.get(e,{params:{page:s,size:20}}),d=i.data.data.list||i.data.list;c.value.push(...d),d.length<20&&(a.value=!0)}catch(i){console.error(i)}},_=async()=>{await f(),a.value=!0},k=async()=>{c.value=[],a.value=!1,await f(),p.value=!1},y=e=>{const s=new Date(e),d=new Date().getTime()-s.getTime(),t=Math.floor(d/1e3),h=Math.floor(t/60),b=Math.floor(h/60),V=Math.floor(b/24);return V>0?`${V}天前`:b>0?`${b}小时前`:h>0?`${h}分钟前`:"刚刚"},w=e=>{L.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const i=F,d=A;return n(),r("div",j,[v(d,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=t=>p.value=t),onRefresh:k},{default:g(()=>[v(i,{loading:l.value,"onUpdate:loading":s[0]||(s[0]=t=>l.value=t),finished:a.value,"finished-text":"没有更多了",onLoad:_},{default:g(()=>[(n(!0),r(N,null,$(c.value,t=>(n(),r("div",{class:"msg-item",key:t.id,onClick:h=>w(t)},[s[4]||(s[4]=o("div",{class:"item-left"},[o("img",{src:P,alt:""})],-1)),o("div",E,[o("div",q,M(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),o("div",H,[e.active==1||t.type=="reply"?(n(),r("div",J,[s[2]||(s[2]=o("span",null,"评论了你:",-1)),o("span",null,M(t.content),1)])):e.active==2||t.type=="like"?(n(),r("div",K,s[3]||(s[3]=[o("span",null,"点赞了你的评论",-1)]))):U("",!0),o("span",O,M(y(t.createdAt)),1)])]),o("div",Q,[o("img",{src:t.seriesCoverUrl,alt:""},null,8,W)])],8,z))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}}),Y=T(X,[["__scopeId","data-v-27401fe5"]]),Z=B({__name:"MessageView",setup(C){const l=I(),a=u(0),p=u(["全部","评论","点赞"]),c=()=>{m()},m=()=>{l.options.history.state?.back!==null?l.back():l.push("/")};return(f,_)=>{const k=D,y=S,w=R;return n(),r("div",null,[v(k,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:c}),v(w,{active:a.value,"onUpdate:active":_[0]||(_[0]=e=>a.value=e),shrink:"","line-width":"3vw",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:g(()=>[(n(!0),r(N,null,$(p.value,e=>(n(),x(y,{title:e,key:e},{default:g(()=>[v(Y,{active:a.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),pe=T(Z,[["__scopeId","data-v-9b6106ca"]]);export{pe as default};
