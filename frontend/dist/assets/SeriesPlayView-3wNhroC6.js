const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-bdvH-EYP.js","assets/index-DYKl5Uqj.js","assets/index-CyC_k5V3.js","assets/index-ys9dfDTb.css","assets/index-IgQk0J1G.js","assets/use-route-CRs7iilB.js","assets/request-ClAEZYGJ.js","assets/index-CjAwa605.css","assets/index-D7cNSy7P.js","assets/index-CpBxbmfY.js","assets/index-DYOx2O91.js","assets/CommentDrawer-BuNgaPMg.js","assets/index.min-BmcZ0e5Q.js","assets/index-BjiV7Ugf.css","assets/index-BnexK8IF.js","assets/index-BzrbYvYM.css","assets/use-id-CTSp4Cgy.js","assets/CommentDrawer-P3eUkAXJ.css","assets/index-DyFGsJnw.js","assets/index-DZQdlh42.js","assets/index-BA7Lzc7q.js","assets/use-placeholder-nVl0cBB3.js","assets/index-BJefcaP8.js","assets/index-HhnxYv-G.js","assets/index-Bu_gGvdP.js","assets/index-DsMqSgSQ.js","assets/index-CDAb0Jla.js"])))=>i.map(i=>d[i]);
import{d as j,r as n,w as B,j as O,x as U,p as Z,a as s,b as y,c as C,k as P,A as b,l as ee,q as G,F as se,n as te,M as oe,o as g,_ as J,D as ae,h as ne,t as ie,u as re}from"./index-CyC_k5V3.js";import{V as le,C as ue}from"./CommentDrawer-BuNgaPMg.js";import{L as de}from"./index-BnexK8IF.js";import{P as K,c as $,s as u}from"./request-ClAEZYGJ.js";import{I as Q}from"./index-DYKl5Uqj.js";import"./index.min-BmcZ0e5Q.js";import"./index-IgQk0J1G.js";import"./use-route-CRs7iilB.js";import"./use-id-CTSp4Cgy.js";const ce={class:"episode-selector"},ve={class:"selector-header"},pe={class:"header-info"},he={key:0},me={class:"episode-grid"},fe=["onClick"],_e={class:"episode-number"},we={key:0,class:"watched-indicator"},ye={class:"selector-footer"},be=j({__name:"EpisodeSelector",props:{visible:{type:Boolean},seriesShortId:{},currentEpisodeShortId:{},currentEpisode:{}},emits:["update:visible","select"],setup(H,{emit:S}){const h=H,k=S,i=n([]),m=n(0),e=n(!1),r=n(!1),f=n(1),z=n(40),I=n(!0),E=n(null),x=async(t=1,_=!1)=>{try{e.value=!0;const w=(await $.get("/api/video/episodes",{params:{seriesShortId:h.seriesShortId,page:t,size:z.value}})).data.data,p=w.list||[],l=I.value?p:[...p].reverse();_?i.value=[...i.value,...l]:i.value=l,m.value=w.total,r.value=!w.hasMore,t===1&&h.currentEpisodeShortId&&(await te(),D())}catch(d){console.error("❌ 加载剧集列表失败:",d);const w=d,{showToast:p}=await oe(async()=>{const{showToast:l}=await import("./index-bdvH-EYP.js");return{showToast:l}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]));p(w.response?.data?.message||"加载剧集失败"),r.value=!0}finally{e.value=!1}},F=async()=>{r.value||(f.value++,await x(f.value,!0))},L=t=>{k("select",t),V()},N=t=>{k("update:visible",t)},V=()=>{k("update:visible",!1)},R=async()=>{I.value=!I.value,f.value=1,r.value=!1,await x(1,!1)},A=()=>{const t=window.innerWidth;return t>=1200?"80%":t>=1024?"75%":t>=768?"70%":"60%"},D=()=>{if(!E.value||!h.currentEpisodeShortId)return;const t=i.value.findIndex(_=>_.shortId===h.currentEpisodeShortId);if(t!==-1){const d=M(),p=Math.floor(t/d)*48;E.value.scrollTop=p}},M=()=>{const t=window.innerWidth;return t>=1200?10:t>=1024?8:t>=768?6:4};return B(()=>h.visible,async t=>{t&&(i.value=[],f.value=1,r.value=!1,await x(1,!1))}),(t,_)=>{const d=Q,w=de,p=K;return g(),O(p,{show:t.visible,"onUpdate:show":N,position:"bottom",style:Z({height:A()}),round:"",onClose:V},{default:U(()=>[s("div",ce,[s("div",ve,[_[1]||(_[1]=s("div",{class:"header-title"},"选集",-1)),s("div",pe,[s("span",null,"共"+b(m.value)+"集",1),t.currentEpisode?(g(),C("span",he,"· 正在播放第"+b(t.currentEpisode)+"集",1)):P("",!0)]),y(d,{name:"cross",class:"close-icon",onClick:V})]),s("div",{class:"episode-list",ref_key:"listContainer",ref:E},[y(w,{loading:e.value,"onUpdate:loading":_[0]||(_[0]=l=>e.value=l),finished:r.value,"finished-text":"没有更多了",onLoad:F},{default:U(()=>[s("div",me,[(g(!0),C(se,null,ee(i.value,l=>(g(),C("div",{key:l.shortId,class:G(["episode-item",{active:t.currentEpisodeShortId===l.shortId,watched:l.isWatched}]),onClick:W=>L(l)},[s("div",_e,b(l.episodeTitle),1),l.isWatched?(g(),C("div",we,[y(d,{name:"success"})])):P("",!0)],10,fe))),128))])]),_:1},8,["loading","finished"])],512),s("div",ye,[s("div",{class:"sort-btn",onClick:R},[y(d,{name:I.value?"descending":"ascending"},null,8,["name"]),s("span",null,b(I.value?"正序":"倒序"),1)])])])]),_:1},8,["show","style"])}}}),ge=J(be,[["__scopeId","data-v-b1e211b0"]]),ke={class:"series-play-container"},Ie={class:"player-wrapper"},Ce={class:"custom-top-bar"},Se={class:"top-left"},Ee={class:"bottom-actions"},xe={class:"info-drawer"},Pe={class:"series-info-content"},Ve={class:"series-title"},Ne={key:0,class:"description-section"},$e={class:"description-text"},Le={class:"info-list"},Te={key:0,class:"info-item"},ze={class:"info-value"},Fe={key:1,class:"info-item"},Re={class:"info-value"},Ae={key:2,class:"info-item"},De={class:"info-value"},Me=j({__name:"SeriesPlayView",setup(H){const S=ie(),h=re(),k=n(""),i=n(null),m=n([]),e=n(null),r=n(1),f=n(0),z=n(null),I=n(!1),E=n(!1),x=ae(()=>r.value<f.value),F=()=>{h.back()},L=async()=>{try{if(m.value=[],e.value=null,i.value=null,r.value=1,f.value=0,!localStorage.getItem("Authorization")){u("请先登录"),h.push("/login");return}const c=(await $.get("/api/video/episodes",{params:{seriesShortId:k.value,page:1,size:200}})).data.data;i.value=c.seriesInfo,m.value=c.list||[],f.value=c.total;const T=S.query.episodeId;if(T){const v=m.value.find(q=>q.shortId===T);v?(e.value=v,r.value=v.episodeNumber):N()}else if(c.userProgress&&c.userProgress.currentEpisodeShortId){const v=m.value.find(q=>q.shortId===c.userProgress.currentEpisodeShortId);v?(e.value=v,r.value=v.episodeNumber):N()}else N()}catch(a){console.error("加载系列数据失败:",a),u("加载失败，请重试")}},N=()=>{m.value.length>0&&(e.value=m.value[0],r.value=m.value[0].episodeNumber)},V=()=>{if(!x.value){u("已经是最后一集了");return}const a=m.value.find(o=>o.episodeNumber===r.value+1);a&&(e.value=a,r.value=a.episodeNumber,h.replace({query:{...S.query,episodeId:a.shortId}}))},R=()=>{x.value?setTimeout(()=>{V()},1e3):u("已播放完所有剧集")},A=()=>{E.value=!0},D=()=>{I.value=!0},M=a=>{e.value=a,r.value=a.episodeNumber,h.replace({query:{...S.query,episodeId:a.shortId}})},t=async()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){u("请先登录");return}try{await $.post("/api/video/episode/activity",{shortId:e.value.shortId,type:"like"}),e.value.isLiked?(e.value.likeCount=Math.max(0,(e.value.likeCount||0)-1),e.value.isLiked=!1,u("已取消点赞")):(e.value.likeCount=(e.value.likeCount||0)+1,e.value.isLiked=!0,u("点赞成功"))}catch(o){console.error("点赞操作失败:",o),u(o.response?.data?.message||"操作失败")}},_=async()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){u("请先登录");return}try{e.value.isFavorited?(await $.post("/api/user/favorites/remove",{shortId:e.value.shortId}),e.value.favoriteCount=Math.max(0,(e.value.favoriteCount||0)-1),e.value.isFavorited=!1,u("已取消收藏")):(await $.post("/api/video/episode/activity",{shortId:e.value.shortId,type:"favorite"}),e.value.favoriteCount=(e.value.favoriteCount||0)+1,e.value.isFavorited=!0,u("收藏成功"))}catch(o){console.error("收藏操作失败:",o),u(o.response?.data?.message||"操作失败")}},d=n(!1),w=n(""),p=n(0),l=()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){u("请先登录");return}w.value=e.value.shortId,p.value=e.value.commentCount||0,d.value=!0},W=()=>{e.value&&(e.value.commentCount=(e.value.commentCount||0)+1,p.value=e.value.commentCount)},X=()=>{u("分享功能开发中")},Y=()=>{};return ne(()=>{if(k.value=S.params.id,!k.value){u("参数错误"),h.back();return}L()}),B(()=>S.params.id,a=>{a&&a!==k.value&&(k.value=a,L())},{immediate:!1}),B(e,a=>{}),(a,o)=>{const c=Q,T=K;return g(),C("div",ke,[s("div",Ie,[e.value?(g(),O(le,{key:0,ref_key:"playerRef",ref:z,"episode-info":e.value,autoplay:!0,muted:!1,"show-view-series-button":!1,onEnded:R,onLike:t,onFavorite:_,onComment:l,onShare:X,onViewSeries:Y},null,8,["episode-info"])):P("",!0),s("div",Ce,[s("div",Se,[y(c,{name:"arrow-left",onClick:F})])]),s("div",Ee,[s("div",{class:"action-btn info-btn",onClick:A},[y(c,{name:"info-o"}),o[3]||(o[3]=s("span",null,"简介",-1))]),s("div",{class:"action-btn episodes-btn",onClick:D},[y(c,{name:"apps-o"}),s("span",null,"选集 "+b(r.value)+"/"+b(f.value),1)]),s("div",{class:G(["action-btn next-btn",{disabled:!x.value}]),onClick:V},[o[4]||(o[4]=s("span",null,"下一集",-1)),y(c,{name:"arrow"})],2)])]),y(ge,{visible:I.value,"onUpdate:visible":o[0]||(o[0]=v=>I.value=v),"series-short-id":k.value,"current-episode-short-id":e.value?.shortId,"current-episode":r.value,onSelect:M},null,8,["visible","series-short-id","current-episode-short-id","current-episode"]),y(T,{show:E.value,"onUpdate:show":o[1]||(o[1]=v=>E.value=v),position:"bottom",style:{height:"70vh",maxHeight:"calc(70vh + env(safe-area-inset-bottom))",borderRadius:"16px 16px 0 0"},closeable:"","close-icon-position":"top-right"},{default:U(()=>[s("div",xe,[s("div",Pe,[s("div",Ve,b(i.value?.title),1),i.value?.description?(g(),C("div",Ne,[s("p",$e,b(i.value.description),1)])):P("",!0),s("div",Le,[i.value?.starring?(g(),C("div",Te,[o[5]||(o[5]=s("span",{class:"info-label"},"主演：",-1)),s("span",ze,b(i.value.starring),1)])):P("",!0),f.value?(g(),C("div",Fe,[o[6]||(o[6]=s("span",{class:"info-label"},"集数：",-1)),s("span",Re,"全"+b(f.value)+"集",1)])):P("",!0),i.value?.tags&&i.value.tags.length?(g(),C("div",Ae,[o[7]||(o[7]=s("span",{class:"info-label"},"标签：",-1)),s("span",De,b(i.value.tags.join(" · ")),1)])):P("",!0)])])])]),_:1},8,["show"]),y(ue,{visible:d.value,"onUpdate:visible":o[2]||(o[2]=v=>d.value=v),"episode-short-id":w.value,"comment-count":p.value,onCommented:W},null,8,["visible","episode-short-id","comment-count"])])}}}),Ke=J(Me,[["__scopeId","data-v-61a280a4"]]);export{Ke as default};
