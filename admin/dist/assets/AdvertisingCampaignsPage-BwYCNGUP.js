import{I as b,j as t}from"./index-FXvYeR5H.js";import{r as i}from"./react-vendor-BZ8KDC-J.js";import{G as et,H as tt,P as st,F as h,s as n,u as rt,b as Q,d as D,I as j,R as E,C as p,f as q,v as ve,l as X,a as v,B as u,J as at,o as nt,m as Y,r as _,x as K,K as ot,g as be,N as Ce,i as lt,j as it,T as I,O as we}from"./antd-vendor-aNvYRewR.js";import{A as L,d as ct,e as W,f as dt}from"./admin-CbwXIqK2.js";import{R as Se}from"./EyeOutlined-C1gWJEUh.js";import{R as Z,a as ut}from"./ReloadOutlined-CFHMM3RM.js";import{R as mt}from"./CopyOutlined-CqLFCNr3.js";import"./client-BbHh6MVO.js";import"./utils-vendor-NIGUFBhG.js";var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"};function se(){return se=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},se.apply(this,arguments)}const ft=(o,r)=>i.createElement(b,se({},o,{ref:r,icon:ht})),Oe=i.forwardRef(ft);function re(){return re=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},re.apply(this,arguments)}const pt=(o,r)=>i.createElement(b,re({},o,{ref:r,icon:et})),Re=i.forwardRef(pt);function ae(){return ae=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},ae.apply(this,arguments)}const gt=(o,r)=>i.createElement(b,ae({},o,{ref:r,icon:tt})),De=i.forwardRef(gt);var xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};function ne(){return ne=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},ne.apply(this,arguments)}const jt=(o,r)=>i.createElement(b,ne({},o,{ref:r,icon:xt})),yt=i.forwardRef(jt);var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};function oe(){return oe=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},oe.apply(this,arguments)}const bt=(o,r)=>i.createElement(b,oe({},o,{ref:r,icon:vt})),Ct=i.forwardRef(bt);var wt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};function le(){return le=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},le.apply(this,arguments)}const St=(o,r)=>i.createElement(b,le({},o,{ref:r,icon:wt})),Ee=i.forwardRef(St);function ie(){return ie=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},ie.apply(this,arguments)}const Ot=(o,r)=>i.createElement(b,ie({},o,{ref:r,icon:st})),ee=i.forwardRef(Ot);var Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"};function ce(){return ce=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])}return o},ce.apply(this,arguments)}const Dt=(o,r)=>i.createElement(b,ce({},o,{ref:r,icon:Rt})),Et=i.forwardRef(Dt),{Search:It}=j,{Option:te}=q,{Text:z}=lt,Ie=[{label:"草稿",value:"draft",color:"default"},{label:"投放中",value:"active",color:"success"},{label:"已暂停",value:"paused",color:"warning"},{label:"已完成",value:"completed",color:"processing"},{label:"已取消",value:"cancelled",color:"error"}],Ft=()=>{const[o,r]=i.useState([]),[a,c]=i.useState([]),[$,de]=i.useState(null),[ue,me]=i.useState(!1),[he,fe]=i.useState(null),[$e,pe]=i.useState(!1),[ke,k]=i.useState(!1),[C,P]=i.useState(null),[ge,H]=i.useState(!1),[w]=h.useForm(),[Pe,xe]=i.useState(null),[Te,G]=i.useState(!1),[J,ze]=i.useState(""),[Me,Ae]=i.useState("campaigns"),[Ye,M]=i.useState(!1),[F,A]=i.useState(null),[T]=h.useForm(),[je]=i.useState(!1),[m,V]=i.useState({keyword:"",platform:"",status:"",dateRange:null}),[g,U]=i.useState({current:1,pageSize:20,total:0}),B=async()=>{console.log("[loadPlatforms] 开始加载平台列表");try{const e=await W.list({enabled:!0});console.log("[loadPlatforms] 平台列表加载成功",e.data),c(e.data||[])}catch(e){console.error("[loadPlatforms] 加载平台列表失败:",e),(e.code==="ECONNREFUSED"||e.response?.status===404)&&c([{id:1,name:"抖音",code:"tiktok",color:"#ff0050",isEnabled:!0,sortOrder:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:2,name:"微信",code:"wechat",color:"#07c160",isEnabled:!0,sortOrder:2,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:3,name:"百度",code:"baidu",color:"#2932e1",isEnabled:!0,sortOrder:3,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}])}},y=i.useCallback(async()=>{console.log("[loadCampaigns] 开始加载投放计划",{platformsCount:a.length,pagination:g,filters:m}),me(!0),fe(null);try{const e={keyword:m.keyword||void 0,platform:m.platform||void 0,status:m.status||void 0};m.dateRange&&(e.startDate=m.dateRange[0].format("YYYY-MM-DD"),e.endDate=m.dateRange[1].format("YYYY-MM-DD")),console.log("[loadCampaigns] 请求参数",{page:g.current,size:g.pageSize,params:e});const s=await L.list(g.current,g.pageSize,e);console.log("[loadCampaigns] API响应",s);const l=(s.data?.items||[]).map(d=>{const f=a.find(x=>x.code===d.platform);return{...d,platformCode:d.platform,platformId:f?.id||0}});console.log("[loadCampaigns] 处理后的数据",{count:l.length,total:s.data?.total}),r(l),U(d=>({...d,total:s.data?.total||0}))}catch(e){console.error("加载投放计划失败:",e);let s="";e.code==="ECONNABORTED"||e.message?.includes("timeout")?(s="请求超时，数据加载时间过长",n.error({content:s+"。请检查网络连接或稍后重试",duration:5})):e.code==="ERR_NETWORK"?(s="网络连接失败",n.error({content:s+"，请检查后端服务是否正常运行",duration:5})):e.response?.status===404?(s="投放计划API接口不存在",n.error(s)):e.response?.status>=500?(s="服务器错误",n.error(s+"，请稍后重试")):(s=e.message||"加载失败",n.error(`加载失败: ${s}`)),fe(s),r([]),U(l=>({...l,total:0}))}finally{me(!1)}},[a,m.keyword,m.platform,m.status,m.dateRange,g.current,g.pageSize]),S=i.useCallback(async()=>{pe(!0);try{const e={};if(m.dateRange){const l=m.dateRange[0].format("YYYY-MM-DD"),d=m.dateRange[1].format("YYYY-MM-DD");e.from=l,e.to=d,e.startDate=l,e.endDate=d}const s=await ct.overview(e);de(s)}catch(e){console.error("加载仪表盘数据失败:",e),de({totalCampaigns:0,activeCampaigns:0,totalSpend:0,totalViews:0,totalClicks:0,totalConversions:0,avgConversionRate:0,platformStats:[],recentEvents:[]}),e.code==="ECONNABORTED"||e.message?.includes("timeout")?n.warning({content:"仪表盘数据加载超时，显示默认数据",duration:3}):e.code!=="ERR_NETWORK"&&n.warning("仪表盘数据加载失败，显示默认数据")}finally{pe(!1)}},[m.dateRange]);i.useEffect(()=>{B()},[]),i.useEffect(()=>{a.length>0&&(console.log("[useEffect] 加载投放计划和仪表盘数据",{platformsCount:a.length,pagination:g,filters:m}),y(),S())},[a.length,y,S]);const _e=async e=>{if(ge){console.log("[handleSubmit] 正在提交中，忽略重复请求");return}H(!0);try{console.log("[handleSubmit] 开始提交表单",{values:e,editingCampaign:C});const s=a.find(d=>d.id===e.platformId);if(!s){n.error("请选择有效的投放平台");return}const l={name:e.name,description:e.description,platform:s.code,targetUrl:e.targetUrl,startDate:e.startDate.format("YYYY-MM-DD"),endDate:e.endDate?.format("YYYY-MM-DD")};if(console.log("[handleSubmit] 准备发送的数据",{payload:l,isEditing:!!C}),C){console.log("[handleSubmit] 更新投放计划",C.id);const d=await L.update(C.id,l);console.log("[handleSubmit] 更新成功",d),n.success("投放计划更新成功")}else{console.log("[handleSubmit] 创建投放计划");const d=await L.create(l);console.log("[handleSubmit] 创建成功",d),n.success("投放计划创建成功")}k(!1),P(null),w.resetFields(),y(),S()}catch(s){H(!1),console.error("[handleSubmit] 保存投放计划失败:",s),console.error("[handleSubmit] 错误详情:",{message:s.message,response:s.response,code:s.code,stack:s.stack}),s.response?.data?.message?n.error(`保存失败: ${s.response.data.message}`):s.code==="ERR_NETWORK"?n.error("网络连接失败，请检查后端服务"):n.error(`保存投放计划失败: ${s.message||"未知错误"}`)}finally{H(!1)}},Le=async e=>{try{await L.remove(e),n.success("投放计划删除成功"),y(),S()}catch(s){console.error("删除投放计划失败:",s),n.error("删除投放计划失败")}},ye=async(e,s)=>{try{await L.updateStatus(e,s),n.success("状态更新成功"),y(),S()}catch(l){console.error("状态更新失败:",l),n.error("状态更新失败")}},Fe=e=>{if(!e.targetUrl){n.error("目标链接不存在");return}const s=e.platformCode||e.platform||"unknown",l=e.campaignCode||`${s}_${e.id}`,d=e.targetUrl.includes("t.me/");let f;if(d){const x=`utm_campaign=${l}&utm_source=${s}`;f=`${e.targetUrl}?startapp=__tgad___${x}`}else{let x=e.targetUrl;x.endsWith("/")&&(x=x.slice(0,-1)),f=`${x}/tgad?utm_campaign=${l}&utm_source=${s}`}navigator.clipboard.writeText(f).then(()=>{n.success("投放链接已复制到剪贴板")}).catch(()=>{n.error("复制失败")})},Ve=async e=>{try{if(xe(e.id),!e.targetUrl){n.error("目标链接不存在");return}const s=e.platformCode||e.platform||"unknown",l=e.campaignCode||`${s}_${e.id}`,d=e.targetUrl.includes("t.me/");let f;if(d){const O=`utm_campaign=${l}&utm_source=${s}`;f=`${e.targetUrl}?startapp=__tgad___${O}`}else{let O=e.targetUrl;O.endsWith("/")&&(O=O.slice(0,-1)),f=`${O}/tgad?utm_campaign=${l}&utm_source=${s}`}const x="m.xgshort.com",Ze=e.endDate?D(e.endDate).toISOString():void 0,N=(await dt.create({originalURL:f,domain:x,allowDuplicates:!1,ttl:Ze}))?.data?.shortURL||"";if(!N){n.error("短链接生成失败");return}ze(N),G(!0);try{if(typeof window<"u"&&window.isSecureContext&&navigator.clipboard)await navigator.clipboard.writeText(N),n.success("短链接已生成并复制到剪贴板");else{const R=document.createElement("textarea");R.value=N,R.style.position="fixed",R.style.opacity="0",document.body.appendChild(R),R.focus(),R.select(),document.execCommand("copy"),document.body.removeChild(R),n.success("短链接已生成并复制到剪贴板")}}catch{n.warning("短链接已生成，请在弹窗中手动复制")}}catch(s){const l=s;l?.response?.data?.message?n.error(`生成失败：${l.response.data.message}`):n.error("短链接生成失败，请稍后重试")}finally{xe(null)}},Ue=e=>{try{console.log("[handleEdit] 开始编辑投放计划",e),P(e);const s=e.startDate?D(e.startDate):null,l=e.endDate?D(e.endDate):null,d={name:e.name,description:e.description,platformId:e.platformId,targetUrl:e.targetUrl,startDate:s||void 0,endDate:l||void 0};console.log("[handleEdit] 设置表单值",d),w.setFieldsValue(d),k(!0),console.log("[handleEdit] 编辑模态框已打开")}catch(s){console.error("[handleEdit] 编辑表单设置失败:",s),n.error(`打开编辑表单失败: ${s instanceof Error?s.message:"未知错误"}`)}},Be=()=>{A(null),T.resetFields(),M(!0)},Ne=e=>{A(e),T.setFieldsValue({name:e.name,code:e.code,description:e.description,color:e.color,isEnabled:e.isEnabled,sortOrder:e.sortOrder}),M(!0)},Ke=async e=>{try{await W.remove(e),n.success("平台删除成功"),B()}catch(s){console.error("删除平台失败:",s),s.response?.status===409?n.error("无法删除该平台：该平台正在被投放计划使用，请先删除相关的投放计划"):s.response?.data?.message?n.error(`删除失败: ${s.response.data.message}`):s.code==="ERR_NETWORK"?n.error("网络连接失败，请检查后端服务"):n.error(`删除平台失败: ${s.message}`)}},We=async e=>{try{const s={name:e.name,code:e.code,description:e.description,color:typeof e.color=="string"?e.color:e.color?.toHexString?.()||"#1890ff",isEnabled:e.isEnabled??!0,sortOrder:e.sortOrder||0};F?(await W.update(F.id,s),n.success("平台更新成功")):(await W.create(s),n.success("平台创建成功")),M(!1),A(null),T.resetFields(),B()}catch(s){if(console.error("保存平台失败:",s),s.response?.data?.message)n.error(`保存失败: ${s.response.data.message}`);else if(s.response?.data?.details){const l=s.response.data.details;if(Array.isArray(l)){const d=l.map(f=>f.constraints?Object.values(f.constraints).join(", "):f).join("; ");n.error(`验证失败: ${d}`)}else n.error(`保存失败: ${JSON.stringify(l)}`)}else s.code==="ERR_NETWORK"?n.error("网络连接失败，请检查后端服务"):n.error(`保存平台失败: ${s.message}`)}},qe=e=>a.find(l=>l.code===e)?.color||"#8c8c8c",He=e=>{const s=Ie.find(l=>l.value===e);return t.jsx(K,{color:s?.color,children:s?.label})},Ge=[{title:"平台名称",dataIndex:"name",key:"name",width:150,render:(e,s)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("div",{style:{width:16,height:16,backgroundColor:s.color,borderRadius:4}}),t.jsx("span",{style:{fontWeight:500},children:e})]})},{title:"平台代码",dataIndex:"code",key:"code",width:120},{title:"描述",dataIndex:"description",key:"description",width:200,render:e=>e||"-"},{title:"状态",dataIndex:"isEnabled",key:"isEnabled",width:100,render:e=>t.jsx(K,{color:e?"success":"default",children:e?"启用":"禁用"})},{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:e=>e||0},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>D(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"actions",width:150,render:e=>t.jsxs(v,{size:"small",children:[t.jsx(u,{type:"text",icon:t.jsx(De,{}),onClick:()=>Ne(e)}),t.jsx(we,{title:"确定要删除这个平台吗？",description:"注意：如果该平台正在被投放计划使用，将无法删除。请先删除相关的投放计划。",onConfirm:()=>Ke(e.id),okText:"确定删除",cancelText:"取消",okButtonProps:{danger:!0},children:t.jsx(u,{type:"text",danger:!0,icon:t.jsx(Re,{})})})]})}],Je=[{title:"计划名称",dataIndex:"name",key:"name",width:200,render:(e,s)=>t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:e}),t.jsx(z,{type:"secondary",style:{fontSize:12},children:s.campaignCode})]})},{title:"投放平台",key:"platform",width:100,render:e=>{const s=e.platformCode||e.platform||"",l=a.find(d=>d.code===s);return t.jsx(K,{color:qe(s),children:l?.name||s||"未知平台"})}},{title:"状态",key:"status",width:100,render:e=>{const s=e.isActive?"active":"paused";return He(s)}},{title:"投放时间",key:"dateRange",width:180,render:e=>t.jsxs("div",{children:[t.jsx("div",{children:D(e.startDate).format("YYYY-MM-DD")}),e.endDate&&t.jsxs(z,{type:"secondary",style:{fontSize:12},children:["至 ",D(e.endDate).format("YYYY-MM-DD")]})]})},{title:"效果数据",key:"stats",width:200,render:e=>{const s=e.stats;if(!s)return"-";const l=s.totalClicks||0,d=s.totalConversions||0,f=l>0?d/l:0;return t.jsxs("div",{children:[t.jsx("div",{children:t.jsxs(z,{strong:!0,children:["点击: ",l.toLocaleString()]})}),t.jsxs("div",{children:[t.jsxs(z,{type:"secondary",style:{fontSize:12},children:["转化: ",d.toLocaleString()]}),t.jsx(it,{type:"vertical"}),t.jsxs(z,{type:"secondary",style:{fontSize:12},children:["转化率: ",(f*100).toFixed(2),"%"]})]})]})}},{title:"操作",key:"actions",width:200,render:e=>t.jsxs(v,{size:"small",children:[t.jsx(I,{title:"查看详情",children:t.jsx(u,{type:"text",icon:t.jsx(Se,{}),onClick:()=>{}})}),t.jsx(I,{title:"编辑",children:t.jsx(u,{type:"text",icon:t.jsx(De,{}),onClick:()=>Ue(e)})}),t.jsx(I,{title:"复制投放链接",children:t.jsx(u,{type:"text",icon:t.jsx(mt,{}),onClick:()=>Fe(e)})}),t.jsx(I,{title:"生成短链接",children:t.jsx(u,{type:"text",icon:t.jsx(ut,{}),loading:Pe===e.id,onClick:()=>Ve(e)})}),e.isActive?t.jsx(I,{title:"暂停",children:t.jsx(u,{type:"text",icon:t.jsx(Ct,{}),onClick:()=>ye(e.id,"paused")})}):t.jsx(I,{title:"启用",children:t.jsx(u,{type:"text",icon:t.jsx(Ee,{}),onClick:()=>ye(e.id,"active")})}),t.jsx(we,{title:"确定要删除这个投放计划吗？",onConfirm:()=>Le(e.id),okText:"确定",cancelText:"取消",children:t.jsx(I,{title:"删除",children:t.jsx(u,{type:"text",danger:!0,icon:t.jsx(Re,{})})})})]})}],Qe=()=>t.jsxs("div",{children:[t.jsxs(Y,{style:{marginBottom:24},loading:$e,children:[t.jsxs(E,{gutter:16,children:[t.jsx(p,{span:6,children:t.jsx(_,{title:"总投放计划",value:$?.totalCampaigns||0,prefix:t.jsx(Oe,{})})}),t.jsx(p,{span:6,children:t.jsx(_,{title:"活跃计划",value:$?.activeCampaigns||0,valueStyle:{color:"#3f8600"},prefix:t.jsx(Ee,{})})}),t.jsx(p,{span:6,children:t.jsx(_,{title:"总访问量",value:$?.totalViews||0,prefix:t.jsx(Se,{})})}),t.jsx(p,{span:6,children:t.jsx(_,{title:"总转化量",value:$?.totalConversions||0,valueStyle:{color:"#cf1322"}})})]}),$?.avgConversionRate!==void 0&&t.jsx(E,{gutter:16,style:{marginTop:16},children:t.jsx(p,{span:6,children:t.jsx(_,{title:"平均转化率",value:($.avgConversionRate*100).toFixed(2),suffix:"%",precision:2})})})]}),t.jsx(Y,{style:{marginBottom:24},children:t.jsxs(E,{gutter:16,align:"middle",children:[t.jsx(p,{flex:"auto",children:t.jsxs(v,{size:"middle",children:[t.jsx(It,{placeholder:"搜索计划名称或代码",style:{width:250},value:m.keyword,onChange:e=>V(s=>({...s,keyword:e.target.value})),onSearch:()=>{U(e=>({...e,current:1})),y()}}),t.jsx(q,{placeholder:"选择平台",style:{width:120},allowClear:!0,value:m.platform||void 0,onChange:e=>V(s=>({...s,platform:e||""})),children:a.map(e=>t.jsx(te,{value:e.code,children:t.jsx(ve,{color:e.color,text:e.name})},e.code))}),t.jsx(q,{placeholder:"选择状态",style:{width:120},allowClear:!0,value:m.status||void 0,onChange:e=>V(s=>({...s,status:e||""})),children:Ie.map(e=>t.jsx(te,{value:e.value,children:t.jsx(K,{color:e.color,children:e.label})},e.value))}),t.jsx(X.RangePicker,{value:m.dateRange,onChange:e=>V(s=>({...s,dateRange:e})),placeholder:["开始日期","结束日期"]})]})}),t.jsx(p,{children:t.jsxs(v,{children:[t.jsx(u,{icon:t.jsx(Z,{}),onClick:()=>{y(),S()},children:"刷新"}),t.jsx(u,{type:"primary",icon:t.jsx(ee,{}),onClick:()=>{P(null),w.resetFields(),k(!0)},children:"新建投放计划"})]})})]})}),t.jsx(Y,{children:he&&!ue?t.jsx(ot,{status:"error",icon:t.jsx(yt,{}),title:"数据加载失败",subTitle:he,extra:t.jsx(u,{type:"primary",icon:t.jsx(Z,{}),onClick:()=>{y(),S()},children:"重新加载"})}):t.jsx(be,{columns:Je,dataSource:o,rowKey:"id",loading:ue,locale:{emptyText:t.jsx(Ce,{description:"暂无投放计划数据",image:Ce.PRESENTED_IMAGE_SIMPLE,children:t.jsx(u,{type:"primary",icon:t.jsx(ee,{}),onClick:()=>{P(null),w.resetFields(),k(!0)},children:"创建第一个投放计划"})})},pagination:{current:g.current,pageSize:g.pageSize,total:g.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`,onChange:(e,s)=>{U(l=>({...l,current:e,pageSize:s||20}))}},scroll:{x:1200}})})]}),Xe=()=>t.jsxs("div",{children:[t.jsx(Y,{style:{marginBottom:24},children:t.jsxs(E,{gutter:16,align:"middle",children:[t.jsx(p,{flex:"auto",children:t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0},children:"平台管理"}),t.jsx(z,{type:"secondary",children:"管理广告投放平台，设置平台信息和显示样式"})]})}),t.jsx(p,{children:t.jsxs(v,{children:[t.jsx(u,{icon:t.jsx(Z,{}),onClick:B,loading:je,children:"刷新"}),t.jsx(u,{type:"primary",icon:t.jsx(ee,{}),onClick:Be,children:"新建平台"})]})})]})}),t.jsx(Y,{children:t.jsx(be,{columns:Ge,dataSource:a,rowKey:"id",loading:je,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个平台`}})})]});return t.jsxs("div",{children:[t.jsx(rt,{activeKey:Me,onChange:Ae,items:[{key:"campaigns",label:t.jsxs("span",{children:[t.jsx(Oe,{}),"投放计划"]}),children:Qe()},{key:"platforms",label:t.jsxs("span",{children:[t.jsx(Et,{}),"平台管理"]}),children:Xe()}]}),t.jsx(Q,{title:C?"编辑投放计划":"新建投放计划",open:ke,onCancel:()=>{try{k(!1),P(null),w.resetFields()}catch(e){console.error("关闭模态框失败:",e)}},footer:null,width:600,destroyOnClose:!0,children:t.jsxs(h,{form:w,layout:"vertical",onFinish:_e,initialValues:{startDate:D()},children:[t.jsx(h.Item,{name:"name",label:"计划名称",rules:[{required:!0,message:"请输入计划名称"}],children:t.jsx(j,{placeholder:"请输入计划名称"})}),t.jsx(h.Item,{name:"description",label:"计划描述",children:t.jsx(j.TextArea,{placeholder:"请输入计划描述",rows:3})}),t.jsx(E,{gutter:16,children:t.jsx(p,{span:12,children:t.jsx(h.Item,{name:"platformId",label:"投放平台",rules:[{required:!0,message:"请选择投放平台"}],children:t.jsx(q,{placeholder:"请选择投放平台",children:a.map(e=>t.jsx(te,{value:e.id,children:t.jsx(ve,{color:e.color,text:e.name})},e.id))})})})}),t.jsx(h.Item,{name:"targetUrl",label:"目标链接",rules:[{required:!0,message:"请输入目标链接"},{type:"url",message:"请输入有效的URL"}],children:t.jsx(j,{placeholder:"https://m.xgshort.com/"})}),t.jsxs(E,{gutter:16,children:[t.jsx(p,{span:12,children:t.jsx(h.Item,{name:"startDate",label:"开始时间",rules:[{required:!0,message:"请选择开始时间"}],children:t.jsx(X,{style:{width:"100%"}})})}),t.jsx(p,{span:12,children:t.jsx(h.Item,{name:"endDate",label:"结束时间",children:t.jsx(X,{style:{width:"100%"}})})})]}),t.jsx(h.Item,{style:{marginBottom:0,textAlign:"right"},children:t.jsxs(v,{children:[t.jsx(u,{onClick:()=>{k(!1),P(null),w.resetFields()},children:"取消"}),t.jsx(u,{type:"primary",htmlType:"submit",loading:ge,children:C?"更新":"创建"})]})})]})}),t.jsx(Q,{title:F?"编辑平台":"新建平台",open:Ye,onCancel:()=>{M(!1),A(null),T.resetFields()},footer:null,width:600,children:t.jsxs(h,{form:T,layout:"vertical",onFinish:We,children:[t.jsx(h.Item,{name:"name",label:"平台名称",rules:[{required:!0,message:"请输入平台名称"}],children:t.jsx(j,{placeholder:"请输入平台名称"})}),t.jsx(h.Item,{name:"code",label:"平台代码",rules:[{required:!0,message:"请输入平台代码"}],children:t.jsx(j,{placeholder:"请输入平台代码"})}),t.jsx(h.Item,{name:"description",label:"平台描述",children:t.jsx(j.TextArea,{placeholder:"请输入平台描述",rows:3})}),t.jsx(h.Item,{name:"color",label:"平台颜色",initialValue:"#1890ff",rules:[{required:!0,message:"请选择平台颜色"},{pattern:/^#[0-9A-Fa-f]{6}$/,message:"请输入有效的颜色值，如 #1890ff"}],children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx(at,{presets:[{label:"推荐颜色",colors:["#ff0050","#07c160","#2932e1","#4285f4","#e6162d","#ff6900","#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"]}]}),t.jsx(j,{placeholder:"请输入颜色值，如 #1890ff",maxLength:7})]})}),t.jsxs(E,{gutter:16,children:[t.jsx(p,{span:12,children:t.jsx(h.Item,{name:"sortOrder",label:"排序",initialValue:0,children:t.jsx(j,{type:"number",placeholder:"排序值，数字越小越靠前"})})}),t.jsx(p,{span:12,children:t.jsx(h.Item,{name:"isEnabled",label:"启用状态",valuePropName:"checked",initialValue:!0,children:t.jsx(nt,{checkedChildren:"启用",unCheckedChildren:"禁用"})})})]}),t.jsx(h.Item,{style:{marginBottom:0,textAlign:"right"},children:t.jsxs(v,{children:[t.jsx(u,{onClick:()=>{M(!1),A(null),T.resetFields()},children:"取消"}),t.jsx(u,{type:"primary",htmlType:"submit",children:F?"更新":"创建"})]})})]})}),t.jsx(Q,{title:"短链接",open:Te,onCancel:()=>G(!1),footer:t.jsxs(v,{children:[t.jsx(u,{onClick:()=>G(!1),children:"关闭"}),t.jsx(u,{type:"primary",onClick:async()=>{try{if(typeof window<"u"&&window.isSecureContext&&navigator.clipboard)await navigator.clipboard.writeText(J);else{const s=document.createElement("textarea");s.value=J,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s)}n.success("已复制到剪贴板")}catch{n.error("复制失败")}},children:"复制"})]}),width:520,destroyOnClose:!0,children:t.jsx(j,{value:J,readOnly:!0})})]})};export{Ft as default};
