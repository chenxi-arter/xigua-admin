import{j as e}from"./index-BLY2COp8.js";import{r as a}from"./react-vendor-BZ8KDC-J.js";import{C as f}from"./admin-c-2Ny3Fo.js";import{F as l,a as C,B as g,s as c,d as _,f as b,I as j,i as L}from"./antd-vendor-CCOR70di.js";import"./utils-vendor-NIGUFBhG.js";function H(){const[w,I]=a.useState(!1),[S,k]=a.useState([]),[D,E]=a.useState(0),[d,N]=a.useState(1),[r,v]=a.useState(10),[F,m]=a.useState(!1),[B,q]=a.useState(null),[u]=l.useForm(),[T,x]=a.useState(!1),[i,p]=a.useState(null),n=a.useCallback(async(t=d,s=r)=>{I(!0);try{const o=await f.list(t,s);k(o.items||[]),E(o.total||0),N(o.page||t),v(o.size||s)}finally{I(!1)}},[d,r]);a.useEffect(()=>{n(1,r)},[n,r]);const O=a.useMemo(()=>[{title:"ID",dataIndex:"id",width:80},{title:"分类ID",dataIndex:"categoryId",width:160},{title:"名称",dataIndex:"name",width:200},{title:"路由名",dataIndex:"routeName",width:160},{title:"启用",dataIndex:"isEnabled",width:80,render:t=>t===!0||t===1||t==="1"||t==="true"?"是":"否"},{title:"操作",width:100,render:(t,s)=>e.jsx(C,{children:e.jsx(g,{type:"link",danger:!0,onClick:()=>{p(s),x(!0)},children:"删除"})})}],[]),z=()=>{u.resetFields(),m(!0)},M=async()=>{const t=await u.validateFields(),s={categoryId:t.categoryId,name:t.name,routeName:t.routeName,isEnabled:t.isEnabled};try{await f.create(s),c.success("已创建"),m(!1),n()}catch(o){const h=o,y=h?.response?.data?.message||h?.response?.data?.msg||h?.message;c.error(y?`保存失败：${y}`:"保存失败")}},P=a.useCallback(async()=>{if(i)try{await f.remove(i.id),c.success("已删除"),n()}catch{c.error("删除失败")}finally{x(!1),p(null)}},[i,n]);return e.jsxs("div",{className:"page",children:[e.jsxs(C,{className:"page-toolbar",children:[e.jsx(g,{type:"primary",onClick:z,children:"新建分类"}),e.jsx(g,{onClick:()=>n(),children:"刷新"})]}),e.jsx(_,{rowKey:"id",loading:w,dataSource:S,columns:O,tableLayout:"fixed",scroll:{x:780},pagination:{current:d,pageSize:r,total:D,position:["bottomCenter"],onChange:(t,s)=>n(t,s)}}),e.jsx(b,{title:"新建分类",open:F,onCancel:()=>m(!1),onOk:M,okText:"保存",width:560,children:e.jsxs(l,{form:u,layout:"vertical",children:[e.jsx(l.Item,{name:"categoryId",label:"分类ID",children:e.jsx(j,{})}),e.jsx(l.Item,{name:"name",label:"名称",rules:[{required:!0}],children:e.jsx(j,{})}),e.jsx(l.Item,{name:"routeName",label:"路由名",children:e.jsx(j,{})}),e.jsx(l.Item,{name:"isEnabled",label:"启用",valuePropName:"checked",children:e.jsx(L,{})})]})}),e.jsx(b,{title:"确认删除",open:T,onOk:P,onCancel:()=>{x(!1),p(null)},okText:"确认删除",cancelText:"取消",okType:"danger",children:e.jsxs("p",{children:["确定要删除分类「",i?.name,"」吗？此操作不可撤销。"]})})]})}export{H as default};
