import{d as $,r as v,p as d,a as h,q as g,E as k,F as I,s as T,y as a,U,k as S,z as B,X as E,v as n,R as V,_ as x,S as z}from"./index-Bd5KdBiY.js";import{T as D,a as F}from"./index-BuRikV4J.js";import"./index-PHjnhdhV.js";import{N as G}from"./index-CFnFVaZW.js";import{P}from"./index-D02okWXm.js";import{L as q}from"./index-BeR7w0_b.js";import{E as A}from"./index-D1Tjcq-t.js";import"./use-id-QpauRjwV.js";import"./use-route-CXzRu5LX.js";import"./use-placeholder-BuYvwL1s.js";const X="/static/img/1.png",j={class:"msg-space"},H=["onClick"],J={class:"badge-box"},K={class:"item-medi"},O={class:"nickname"},Q={class:"info"},W={key:0},Y={key:1},Z={class:"time"},ee={class:"item-right"},te=["src"],se=$({__name:"MsgComp",props:{active:{}},setup(N){const i=v(!1),r=v(!1),m=v(!1),l=v([]),c=N,y=async()=>{let e="";c.active==0?e="/api/notifications/unread":c.active==1?e="/api/video/episode/my-unread-replies":c.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(l.value.length/20)+1;try{const o=await V.get(e,{params:{page:s,size:20}}),u=o.data.data.list||o.data.list;l.value.push(...u),u.length<20&&(r.value=!0)}catch(o){console.error(o)}},_=async()=>{await y(),i.value=!1},w=async()=>{l.value=[],r.value=!1,i.value=!0,await _(),m.value=!1},b=e=>{const s=new Date(e),u=new Date().getTime()-s.getTime(),C=Math.floor(u/1e3),f=Math.floor(C/60),t=Math.floor(f/60),R=Math.floor(t/24);return R>0?`${R}天前`:t>0?`${t}小时前`:f>0?`${f}分钟前`:"刚刚"},M=async e=>{const s="/api/video/episode/replies/mark-read";try{await V.post(s,{replyIds:[e]})}catch(o){console.error(o)}},p=async e=>{const s="/api/video/comment/likes/mark-read";try{await V.post(s,{replyIds:[e]})}catch(o){console.error(o)}},L=async e=>{c.active==1||e.type=="reply"?await M(e.id):(c.active==2||e.type=="like")&&await p(e.id),e.isRead=!0,E.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const o=A,u=S,C=q,f=P;return n(),d("div",j,[h(f,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),onRefresh:w},{default:g(()=>[r.value&&l.value.length==0?(n(),k(o,{key:0,"image-size":"100",description:"暂无内容"})):(n(),k(C,{key:1,loading:i.value,"onUpdate:loading":s[0]||(s[0]=t=>i.value=t),finished:r.value,"finished-text":"没有更多了",onLoad:_},{default:g(()=>[(n(!0),d(I,null,T(l.value,t=>(n(),d("div",{class:"msg-item",key:t.id,onClick:R=>L(t)},[a("div",J,[t.isRead?U("",!0):(n(),k(u,{key:0,dot:""}))]),s[4]||(s[4]=a("div",{class:"item-left"},[a("img",{src:X,alt:""})],-1)),a("div",K,[a("div",O,B(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),a("div",Q,[e.active==1||t.type=="reply"?(n(),d("div",W,[s[2]||(s[2]=a("span",null,"评论了你:",-1)),a("span",null,B(t.content),1)])):e.active==2||t.type=="like"?(n(),d("div",Y,s[3]||(s[3]=[a("span",null,"点赞了你的评论",-1)]))):U("",!0),a("span",Z,B(b(t.createdAt)),1)])]),a("div",ee,[a("img",{src:t.seriesCoverUrl,alt:""},null,8,te)])],8,H))),128))]),_:1},8,["loading","finished"]))]),_:1},8,["modelValue"])])}}}),ae=x(se,[["__scopeId","data-v-776651fb"]]),oe=$({__name:"MessageView",setup(N){const i=z(),r=v(0),m=v(["全部","评论","点赞"]),l=()=>{c()},c=()=>{i.options.history.state?.back!==null?i.back():i.push("/")};return(y,_)=>{const w=G,b=F,M=D;return n(),d("div",null,[h(w,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:l}),h(M,{active:r.value,"onUpdate:active":_[0]||(_[0]=p=>r.value=p),shrink:"","line-width":"3vw",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:g(()=>[(n(!0),d(I,null,T(m.value,p=>(n(),k(b,{title:p,key:p},{default:g(()=>[h(ae,{active:r.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),_e=x(oe,[["__scopeId","data-v-9b6106ca"]]);export{_e as default};
