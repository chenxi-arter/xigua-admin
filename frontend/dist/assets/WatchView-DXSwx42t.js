import{d as J,r as o,n as K,l as Q,b as x,c as l,w as a,f as n,F as M,e as A,o as d,j as B,t as L,z as X,A as Y,q as Z}from"./index-BUt-9d1d.js";import{T as ee,a as te}from"./index-CqX3qSc-.js";import"./index-Dgq7X-t3.js";import{C as oe}from"./index-DBGvqUvw.js";import{P as se}from"./index-22Lr7j6y.js";import{L as ae}from"./index-CtvN6bhi.js";import{R as le,C as ne}from"./index-N2QlJerl.js";import{I as re}from"./index-DgOa4PE7.js";import{s as F,L as ie}from"./request-CJrpamSW.js";import"./index-CiRnDQBv.js";import"./use-id-DYAqg3Jf.js";import"./use-route-CUL3gVxm.js";const ce={class:"watch-contain"},ue={class:"video-info"},de={style:{color:"white","font-size":"13px"}},ve=["src"],pe={class:"reply"},Ve=J({__name:"WatchView",setup(fe){const b=o(!1),v=o(!1),p=o(!1),k=o(!1),_=o(!1),y=o(!1),C=o(0),r=o([]),i=o([]),T=async()=>{try{const s=await F.get("/api/video/browse-history",{params:{page:Math.floor(i.value.length/20)+1,size:20}}),t=s.data.data||s.data,{list:c,total:u}=t;i.value.push(...c),i.value.length>=u&&(k.value=!0)}catch(s){console.error(s),y.value=!0}},S=async()=>{try{const s=await F.get("/api/user/favorites",{params:{page:Math.floor(r.value.length/20)+1,size:20}}),t=s.data.data||s.data,{list:c,total:u}=t;r.value.push(...c),r.value.length>=u&&(b.value=!0)}catch(s){console.error(s),_.value=!0}},N=async()=>{v.value=!0,await S(),v.value=!1},P=async()=>{p.value=!0,await T(),p.value=!1},f=o("");K(()=>{/iphone|ipod|android|blackberry|windows phone/i.test(navigator.userAgent.toLowerCase())?f.value="seriesPlay":f.value="play"});const W=async s=>{Y.push({name:f.value,params:{id:s}})},h=o(),V=o(0),m=o(),U=o(0),D=()=>{V.value=h.value.scrollTop},H=()=>{U.value=m.value.scrollTop};Q(()=>{Z(()=>{h.value&&(h.value.scrollTop=V.value),m.value&&(m.value.scrollTop=U.value)})});const g=o(!1),w=o(!1),O=async()=>{r.value=[],await S(),g.value=!1},j=async()=>{i.value=[],await T(),w.value=!1};return(s,t)=>{const c=ie,u=re,q=ne,E=le,I=ae,z=se,R=te,$=oe,G=ee;return d(),x("div",ce,[l(G,{active:C.value,"onUpdate:active":t[6]||(t[6]=e=>C.value=e),swipeable:"",shrink:"",background:"rgba(101, 102, 102, 0.0)","title-active-color":"white","line-width":"20px",style:{flex:"1",height:"100%"}},{default:a(()=>[l(R,{title:"我的收藏","title-style":"font-size: 16px"},{default:a(()=>[l(z,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=e=>g.value=e),onRefresh:O,"success-text":"刷新成功"},{default:a(()=>[n("div",{class:"watch-scroll-box",ref_key:"watchListContainer",ref:h,onScroll:D},[l(I,{loading:v.value,"onUpdate:loading":t[0]||(t[0]=e=>v.value=e),finished:b.value,error:_.value,"onUpdate:error":t[1]||(t[1]=e=>_.value=e),"error-text":"请求失败，点击重新加载","finished-text":"没有更多了",onLoad:N,class:"watch-list",role:""},{default:a(()=>[l(E,{gutter:[12,12],style:{padding:"12px"}},{default:a(()=>[(d(!0),x(M,null,A(r.value,e=>(d(),B(q,{key:e.seriesId,span:"8",onClick:he=>W(e.seriesShortId)},{default:a(()=>[n("div",ue,[l(u,{fit:"contain",src:e.seriesCoverUrl},{loading:a(()=>[l(c,{type:"spinner",size:"20"})]),_:2},1032,["src"]),n("div",de,L(e.seriesTitle),1)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["loading","finished","error"])],544)]),_:1},8,["modelValue"])]),_:1}),l(R,{title:"播放历史","title-style":"font-size: 16px"},{default:a(()=>[l(z,{modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=e=>w.value=e),onRefresh:j,"success-text":"刷新成功"},{default:a(()=>[n("div",{class:"watch-scroll-box",ref_key:"historyListContainer",ref:m,onScroll:H},[l(I,{loading:p.value,"onUpdate:loading":t[3]||(t[3]=e=>p.value=e),finished:k.value,error:y.value,"onUpdate:error":t[4]||(t[4]=e=>y.value=e),"error-text":"请求失败，点击重新加载","finished-text":"没有更多了",class:"history-list",onLoad:P,"immediate-check":!1,style:{height:"100%",flex:"1"}},{default:a(()=>[(d(!0),x(M,null,A(i.value,e=>(d(),B($,{key:e.seriesId,"is-link":"",center:"",border:!1,to:{name:f.value,params:{id:e.seriesShortId}},"title-style":{color:"white"}},{title:a(()=>[X(L(e.seriesTitle),1)]),icon:a(()=>[n("img",{src:e.seriesCoverUrl,alt:"",style:{width:"64px",height:"86px",margin:"0 13px 0 0"}},null,8,ve)]),label:a(()=>[t[7]||(t[7]=n("span",{style:{color:"black"}},null,-1)),n("span",pe,L(e.watchStatus),1)]),_:2},1032,["to"]))),128))]),_:1},8,["loading","finished","error"])],544)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["active"])])}}});export{Ve as default};
