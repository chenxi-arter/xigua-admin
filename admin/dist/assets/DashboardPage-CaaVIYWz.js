import{I as X,j as e,R as C,a as W,b as v,c as M}from"./index-Bga7-WXN.js";import{r as i,j as Y}from"./react-vendor-BZ8KDC-J.js";import{D as p,B}from"./admin-BuVr2CaF.js";import{R as c,C as t,m as o,r as l,g as Z,i as S,t as m}from"./antd-vendor-aNvYRewR.js";import{R as U}from"./EyeOutlined-wHIdmrrO.js";import"./client-BbHh6MVO.js";import"./utils-vendor-NIGUFBhG.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917 211.1l-199.2 24c-6.6.8-9.4 8.9-4.7 13.6l59.3 59.3-226 226-101.8-101.7c-6.3-6.3-16.4-6.2-22.6 0L100.3 754.1a8.03 8.03 0 000 11.3l45 45.2c3.1 3.1 8.2 3.1 11.3 0L433.3 534 535 635.7c6.3 6.2 16.4 6.2 22.6 0L829 364.5l59.3 59.3a8.01 8.01 0 0013.6-4.7l24-199.2c.7-5.1-3.7-9.5-8.9-8.8z"}}]},name:"rise",theme:"outlined"};function R(){return R=Object.assign?Object.assign.bind():function(d){for(var r=1;r<arguments.length;r++){var j=arguments[r];for(var h in j)Object.prototype.hasOwnProperty.call(j,h)&&(d[h]=j[h])}return d},R.apply(this,arguments)}const se=(d,r)=>i.createElement(X,R({},d,{ref:r,icon:ee})),te=i.forwardRef(se);function ce(){const d=Y(),[r,j]=i.useState(null),[h,L]=i.useState([]),[u,D]=i.useState({users:[],series:[],episodes:[],comments:[]}),[n,w]=i.useState(!1),[O,P]=i.useState([]),[F,I]=i.useState([]),[k,N]=i.useState(!1),[b,_]=i.useState(!1),[y,E]=i.useState(null),[x,K]=i.useState(null),q=async()=>{w(!0);try{const s=new Date(Date.now()-12096e5).toISOString().slice(0,10),f=new Date().toISOString().slice(0,10),[a,G,H,J,Q,T,$]=await Promise.all([p.overview(),p.top({metric:"series_play",limit:10}),p.recentActivities({limit:10}),p.timeseries({from:s,to:f,granularity:"day"}),B.list(1,1),p.activeUsers(),p.watchStats()]);j(a),L(G.items||[]),D(H),P(J.series||[]),E(T?.data||T||null),K($?.data||$||null);const z=Q?.items?.[0];if(z?.id!=null){const A=await B.stats(z.id,{from:s,to:f}),V=Array.isArray(A)?A:[];I(V.map(g=>({date:g.date,impressions:g.impressions||0,clicks:g.clicks||0,ctr:g.impressions?Math.round((g.clicks||0)/g.impressions*1e3)/10:0})))}else I([])}finally{w(!1)}};return i.useEffect(()=>{q()},[]),e.jsxs("div",{className:"page",children:[e.jsxs(c,{gutter:[16,16],children:[e.jsx(t,{xs:24,sm:12,lg:6,children:e.jsx(o,{loading:n,hoverable:!0,onClick:()=>d("/users"),style:{borderRadius:8,cursor:"pointer",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},bodyStyle:{padding:"20px 24px"},children:e.jsx(l,{title:e.jsx("span",{style:{color:"rgba(255,255,255,0.85)",fontSize:14},children:"用户总数"}),value:r?.users.total||0,suffix:e.jsxs("span",{style:{fontSize:14,color:"rgba(255,255,255,0.75)"},children:["(+",r?.users.new24h||0,"/24h)"]}),prefix:e.jsx(C,{style:{color:"#fff"}}),valueStyle:{color:"#fff",fontSize:28,fontWeight:600}})})}),e.jsx(t,{xs:24,sm:12,lg:6,children:e.jsx(o,{loading:n,hoverable:!0,onClick:()=>d("/banners"),style:{borderRadius:8,cursor:"pointer",background:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",border:"none"},bodyStyle:{padding:"20px 24px"},children:e.jsx(l,{title:e.jsx("span",{style:{color:"rgba(255,255,255,0.85)",fontSize:14},children:"轮播图"}),value:r?.banners.total||0,prefix:e.jsx(W,{style:{color:"#fff"}}),valueStyle:{color:"#fff",fontSize:28,fontWeight:600}})})}),e.jsx(t,{xs:24,sm:12,lg:6,children:e.jsx(o,{loading:n,hoverable:!0,onClick:()=>d("/series"),style:{borderRadius:8,cursor:"pointer",background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",border:"none"},bodyStyle:{padding:"20px 24px"},children:e.jsx(l,{title:e.jsx("span",{style:{color:"rgba(255,255,255,0.85)",fontSize:14},children:"系列总数"}),value:r?.series.total||0,prefix:e.jsx(v,{style:{color:"#fff"}}),valueStyle:{color:"#fff",fontSize:28,fontWeight:600}})})}),e.jsx(t,{xs:24,sm:12,lg:6,children:e.jsx(o,{loading:n,hoverable:!0,onClick:()=>d("/episodes"),style:{borderRadius:8,cursor:"pointer",background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",border:"none"},bodyStyle:{padding:"20px 24px"},children:e.jsx(l,{title:e.jsx("span",{style:{color:"rgba(255,255,255,0.85)",fontSize:14},children:"剧集总数"}),value:r?.episodes.total||0,prefix:e.jsx(M,{style:{color:"#fff"}}),valueStyle:{color:"#fff",fontSize:28,fontWeight:600}})})})]}),e.jsxs(c,{gutter:[16,16],style:{marginTop:16},children:[e.jsx(t,{xs:24,lg:12,children:e.jsx(o,{title:"活跃用户（DAU/WAU/MAU）",loading:n,style:{borderRadius:8},children:e.jsxs(c,{gutter:[16,16],children:[e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"DAU",value:y?.dau??0,valueStyle:{color:"#1677ff"}})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"WAU",value:y?.wau??0,valueStyle:{color:"#52c41a"}})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"MAU",value:y?.mau??0,valueStyle:{color:"#fa8c16"}})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"粘性(%)",value:Number((y?.sticky||0).toFixed?.(2)??y?.sticky??0),suffix:"%"})})]})})}),e.jsx(t,{xs:24,lg:12,children:e.jsx(o,{title:"观影统计",loading:n,style:{borderRadius:8},children:e.jsxs(c,{gutter:[16,16],children:[e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"平均日观看时长",value:x?.averageWatchProgress?(()=>{const s=Math.floor(x.averageWatchProgress),f=Math.floor(s/60),a=s%60;return`${f}分${a}秒`})():"0分0秒",valueStyle:{fontSize:16}})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"平均观看(%)",value:Number((x?.averageWatchPercentage||0).toFixed?.(2)??x?.averageWatchPercentage??0),suffix:"%"})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"总观看时长",value:x?.totalWatchTime?(()=>{const s=x.totalWatchTime,f=Math.floor(s/3600),a=Math.floor(s%3600/60);return f>0?`${f}时${a}分`:`${a}分`})():"0分",valueStyle:{fontSize:16}})}),e.jsx(t,{xs:12,md:6,children:e.jsx(l,{title:"完播率(%)",value:Number((x?.completionRate||0).toFixed?.(2)??x?.completionRate??0),suffix:"%"})})]})})})]}),e.jsx(c,{gutter:[16,16],style:{marginTop:16},children:e.jsx(t,{span:24,children:e.jsxs(o,{title:"轮播统计（24h/累计）",loading:n,style:{borderRadius:8},children:[e.jsxs(c,{gutter:[32,16],children:[e.jsx(t,{xs:24,sm:12,md:8,children:e.jsx(l,{title:"总曝光",value:r?.banners.totalImpressions??0,prefix:e.jsx(U,{}),valueStyle:{color:"#1677ff"}})}),e.jsx(t,{xs:24,sm:12,md:8,children:e.jsx(l,{title:"总点击",value:r?.banners.totalClicks??0,prefix:e.jsx(W,{}),valueStyle:{color:"#52c41a"}})}),e.jsx(t,{xs:24,sm:12,md:8,children:e.jsx(l,{title:"平均点击率",value:r?.banners.totalImpressions?((r?.banners.totalClicks||0)/r.banners.totalImpressions*100).toFixed(2):0,suffix:"%",valueStyle:{color:"#fa8c16"}})})]}),e.jsx("div",{style:{marginTop:20,paddingTop:16,borderTop:"1px solid #f0f0f0"},children:e.jsx("a",{onClick:()=>d("/banners"),style:{fontSize:14},children:"去管理轮播图 →"})})]})})}),e.jsxs(c,{gutter:[16,16],style:{marginTop:16},children:[e.jsx(t,{xs:24,lg:12,children:e.jsx(o,{title:e.jsxs("span",{children:[e.jsx(te,{style:{marginRight:8,color:"#1677ff"}}),"用户增长（近两周）"]}),loading:n,style:{borderRadius:8,height:"100%"},children:e.jsx("div",{style:{height:220,display:"flex",alignItems:"flex-end",gap:6,padding:"12px 0",background:"#fafafa",borderRadius:6,paddingLeft:12,paddingRight:12},children:O.map(s=>e.jsx("div",{title:`${s.date}
新增: ${s.newUsers} 人`,style:{flex:1,height:`${Math.max(8,Math.min(190,s.newUsers*1.5))}px`,background:"linear-gradient(180deg, #667eea 0%, #764ba2 100%)",borderRadius:"4px 4px 0 0",transition:"all 0.3s",cursor:"pointer",boxShadow:"0 2px 4px rgba(102, 126, 234, 0.2)"}},s.date))})})}),e.jsx(t,{xs:24,lg:12,children:e.jsx(o,{title:e.jsxs("span",{children:[e.jsx(U,{style:{marginRight:8,color:"#52c41a"}}),"轮播点击率CTR（近两周）"]}),loading:n,style:{borderRadius:8,height:"100%"},children:e.jsx("div",{style:{height:220,display:"flex",alignItems:"flex-end",gap:6,padding:"12px 0",background:"#fafafa",borderRadius:6,paddingLeft:12,paddingRight:12},children:F.map(s=>e.jsx("div",{title:`${s.date}
CTR: ${s.ctr}%
曝光: ${s.impressions}
点击: ${s.clicks}`,style:{flex:1,height:`${Math.max(8,Math.min(190,Math.round(s.ctr*15)))}px`,background:"linear-gradient(180deg, #52c41a 0%, #73d13d 100%)",borderRadius:"4px 4px 0 0",transition:"all 0.3s",cursor:"pointer",boxShadow:"0 2px 4px rgba(82, 196, 26, 0.2)"}},s.date))})})})]}),e.jsx(c,{gutter:[16,16],style:{marginTop:16},children:e.jsx(t,{span:24,children:e.jsx(o,{title:e.jsxs("span",{children:[e.jsx(v,{style:{marginRight:8,color:"#1677ff"}}),"Top 系列（播放量）"]}),loading:n,extra:e.jsx("a",{onClick:()=>N(s=>!s),children:k?"收起":"展开更多"}),style:{borderRadius:8},children:e.jsx(Z,{rowKey:s=>`${s.seriesId}`,size:"middle",dataSource:k?h:(h||[]).slice(0,5),pagination:!1,columns:[{title:"排名",width:80,render:(s,f,a)=>e.jsxs("span",{style:{fontWeight:a<3?"bold":"normal",color:a===0?"#f5222d":a===1?"#fa8c16":a===2?"#faad14":"#666"},children:["#",a+1]})},{title:"系列ID",dataIndex:"seriesId",width:100},{title:"标题",dataIndex:"title"},{title:"播放量",dataIndex:"playCount",width:150,render:s=>e.jsx("span",{style:{color:"#1677ff",fontWeight:500},children:s?.toLocaleString()||0})}]})})})}),e.jsx(c,{gutter:[16,16],style:{marginTop:16,marginBottom:16},children:e.jsx(t,{span:24,children:e.jsx(o,{title:"最新动态",loading:n,extra:e.jsx("a",{onClick:()=>_(s=>!s),children:b?"收起":"展开更多"}),style:{borderRadius:8},children:e.jsxs(c,{gutter:[16,16],children:[e.jsxs(t,{xs:24,md:8,children:[e.jsxs(S.Title,{level:5,style:{marginBottom:12},children:[e.jsx(C,{style:{marginRight:8,color:"#667eea"}}),"新增用户"]}),e.jsx(m,{size:"small",dataSource:b?u.users:(u.users||[]).slice(0,5),renderItem:s=>e.jsxs(m.Item,{style:{borderBottom:"1px solid #f0f0f0",padding:"8px 0"},children:[e.jsxs("span",{style:{color:"#666"},children:["#",s.id]}),e.jsx("span",{style:{marginLeft:8},children:s.username})]})})]}),e.jsxs(t,{xs:24,md:8,children:[e.jsxs(S.Title,{level:5,style:{marginBottom:12},children:[e.jsx(v,{style:{marginRight:8,color:"#4facfe"}}),"新增系列"]}),e.jsx(m,{size:"small",dataSource:b?u.series:(u.series||[]).slice(0,5),renderItem:s=>e.jsxs(m.Item,{style:{borderBottom:"1px solid #f0f0f0",padding:"8px 0"},children:[e.jsxs("span",{style:{color:"#666"},children:["#",s.id]}),e.jsx("span",{style:{marginLeft:8},children:s.title})]})})]}),e.jsxs(t,{xs:24,md:8,children:[e.jsxs(S.Title,{level:5,style:{marginBottom:12},children:[e.jsx(M,{style:{marginRight:8,color:"#f5576c"}}),"新增剧集"]}),e.jsx(m,{size:"small",dataSource:b?u.episodes:(u.episodes||[]).slice(0,5),renderItem:s=>e.jsxs(m.Item,{style:{borderBottom:"1px solid #f0f0f0",padding:"8px 0"},children:[e.jsxs("span",{style:{color:"#666"},children:["#",s.id]}),e.jsx("span",{style:{marginLeft:8},children:s.title})]})})]})]})})})})]})}export{ce as default};
