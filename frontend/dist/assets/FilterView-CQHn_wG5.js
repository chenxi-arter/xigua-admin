import{d as S,r as o,N as Y,O as I,i as L,P as V,p as f,q as r,y as s,z as R,a as _,s as u,F as C,v as w,D as x,T as P,U as D,_ as j}from"./index-HO-epKTq.js";import{P as z}from"./index-KRom8cOv.js";import{L as J}from"./index-C_jzmiBB.js";import{R as Z,C as K}from"./index-Dmbd4rlR.js";import{T as W,a as $}from"./index-D3ilxJ0U.js";import"./index-BfjPN7_M.js";import{C as ee}from"./CoverComp-CF4_nTgn.js";import"./use-id-DmqdHbGY.js";import"./use-route-CMFZV0T5.js";import"./index-D_9Oi4Ru.js";const ae={class:"channel_navigation flex h_100_vh flex_direction-column"},te={class:"nav-bar relative van-hairline--bottom"},se={class:"center flex_auto"},le={class:"flex_auto page_content relative"},oe={class:"load-box"},ne={class:"overflow-hidden"},re={class:"load-box bottom_load_box"},ie=S({__name:"FilterView",setup(ue){const k=o(1),h=o(!1),A=Y(),c=I(),v=o(),B=o(0),l=L({get:()=>({channeid:c.query.channeid,ids:c.query.ids,page:c.query.page?Number(c.query.page):k.value,size:20}),set:e=>{e.page!==void 0&&(k.value=e.page)}}),m=o([]),n=o(!1),d=o(!1),y=o(),i=o([]),b=o({list:[]}),g=async()=>{try{const e=await D.get("/api/list/getfiltersdata",{params:l.value}),a=e.data.data?.list?.length??0;d.value=a===0||a<l.value.size,i.value.push(...e.data.data?.list??[])}catch(e){console.error("失败：",e),h.value=!0,l.value.page--}},Q=async()=>{d.value=!1,l.value.page=1,i.value=[],await g(),y.value=!1},T=async()=>{d.value=!1,l.value.page=1,l.value.ids=m.value.map((e,a)=>b.value.list[a]?.list[e]?.index??0).join(","),A.replace({query:{...c.query,ids:l.value.ids}}),i.value=[],n.value=!0,await g(),n.value=!1},N=async()=>{n.value=!0,l.value.page++,await g(),n.value=!1};V(async()=>{if(!A.options.history.state.forward||!i.value.length){d.value=!1,m.value=l.value.ids.split(",").map(e=>Number(e)),l.value.page=1,i.value=[],n.value=!0,await g(),n.value=!1;try{const e=await D.get("/api/list/getfilterstags");b.value=e.data.data}catch(e){console.error("失败：",e)}}v.value&&(v.value.scrollTop=B.value)});const O=()=>{v.value&&(B.value=v.value.scrollTop)},U=()=>{window.history.state?.back?A.back():A.push("/")};return(e,a)=>{const q=$,G=W,H=K,X=Z,F=J,M=z;return r(),f("div",ae,[s("div",te,[s("div",{class:"left",onClick:U},a[3]||(a[3]=[s("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"",class:"left-arrow"},null,-1)])),s("div",se,R(i.value?.[0]?.type),1),a[4]||(a[4]=s("div",{class:"right"},null,-1))]),s("div",le,[s("div",oe,[s("div",{class:"scroll-box",ref_key:"listContainer",ref:v,onScroll:O},[_(M,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=t=>y.value=t),onRefresh:Q,"success-text":"刷新成功"},{default:u(()=>[s("div",ne,[(r(!0),f(C,null,w(b.value.list,(t,E)=>(r(),f("div",{class:"tabs",key:t.name},[_(G,{active:m.value[E],"onUpdate:active":p=>m.value[E]=p,onChange:T,role:""},{default:u(()=>[(r(!0),f(C,null,w(t.list,p=>(r(),x(q,{key:p.classifyId},{title:u(()=>[s("span",null,R(p.classifyName=="全部"?"最近上传":p.classifyName),1)]),_:2},1024))),128))]),_:2},1032,["active","onUpdate:active"])]))),128)),s("div",re,[_(F,{loading:n.value,"onUpdate:loading":a[0]||(a[0]=t=>n.value=t),"immediate-check":!1,finished:d.value,error:h.value,"onUpdate:error":a[1]||(a[1]=t=>h.value=t),"error-text":"请求失败，点击重新加载","finished-text":"没有更多了",onLoad:N,class:"list",role:""},{default:u(()=>[_(X,{gutter:"10"},{default:u(()=>[(r(!0),f(C,null,w(i.value,t=>(r(),x(H,{key:t.id,span:"8"},{default:u(()=>[t.shortId?(r(),x(ee,{key:0,MvItem:t,islist:!1},null,8,["MvItem"])):P("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","finished","error"])])])]),_:1},8,["modelValue"])],544)])])])}}}),ye=j(ie,[["__scopeId","data-v-6eb2a1f2"]]);export{ye as default};
