import{d as S,r as o,a as Y,p as I,l as L,b as f,f as s,t as R,c as _,w as u,s as V,F as C,e as w,j as x,x as j,o as n,_ as J}from"./index-CsxTmlqy.js";import{P}from"./index-Fe-ONvHF.js";import{L as z}from"./index-CR35iaPi.js";import{R as Z,C as K}from"./index-9qt8QB0a.js";import{T as W,a as $}from"./index-8EwRd44h.js";import"./index-DasOJIcN.js";import{s as Q}from"./request-_ut632Zk.js";import{C as ee}from"./CoverComp-VepYTf-x.js";import"./index-h6WXa7Ka.js";import"./use-id-B319J1Kq.js";import"./use-route-8zHza4Ro.js";import"./index-vwMmxIhh.js";const ae={class:"channel_navigation flex h_100_vh flex_direction-column"},te={class:"nav-bar relative van-hairline--bottom"},se={class:"center flex_auto"},le={class:"flex_auto page_content relative"},oe={class:"load-box"},re={class:"overflow-hidden"},ne={class:"load-box bottom_load_box"},ie=S({__name:"FilterView",setup(ue){const k=o(1),h=o(!1),m=V(),c=I(),v=o(),B=o(0),l=Y({get:()=>({channeid:c.query.channeid,ids:c.query.ids,page:c.query.page?Number(c.query.page):k.value,size:20}),set:e=>{e.page!==void 0&&(k.value=e.page)}}),A=o([]),r=o(!1),d=o(!1),y=o(),i=o([]),b=o({list:[]}),g=async()=>{try{const e=await Q.get("/api/list/getfiltersdata",{params:l.value}),a=e.data.data?.list?.length??0;d.value=a===0||a<l.value.size,i.value.push(...e.data.data?.list??[])}catch(e){console.error("失败：",e),h.value=!0,l.value.page--}},D=async()=>{d.value=!1,l.value.page=1,i.value=[],await g(),y.value=!1},T=async()=>{d.value=!1,l.value.page=1,l.value.ids=A.value.map((e,a)=>b.value.list[a]?.list[e]?.index??0).join(","),m.replace({query:{...c.query,ids:l.value.ids}}),i.value=[],r.value=!0,await g(),r.value=!1},N=async()=>{r.value=!0,l.value.page++,await g(),r.value=!1};L(async()=>{if(!m.options.history.state.forward||!i.value.length){d.value=!1,A.value=l.value.ids.split(",").map(e=>Number(e)),l.value.page=1,i.value=[],r.value=!0,await g(),r.value=!1;try{const e=await Q.get("/api/list/getfilterstags");b.value=e.data.data}catch(e){console.error("失败：",e)}}v.value&&(v.value.scrollTop=B.value)});const O=()=>{v.value&&(B.value=v.value.scrollTop)},U=()=>{window.history.state?.back?m.back():m.push("/")};return(e,a)=>{const G=$,H=W,X=K,q=Z,F=z,M=P;return n(),f("div",ae,[s("div",te,[s("div",{class:"left",onClick:U},a[3]||(a[3]=[s("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"",class:"left-arrow"},null,-1)])),s("div",se,R(i.value?.[0]?.type),1),a[4]||(a[4]=s("div",{class:"right"},null,-1))]),s("div",le,[s("div",oe,[s("div",{class:"scroll-box",ref_key:"listContainer",ref:v,onScroll:O},[_(M,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=t=>y.value=t),onRefresh:D,"success-text":"刷新成功"},{default:u(()=>[s("div",re,[(n(!0),f(C,null,w(b.value.list,(t,E)=>(n(),f("div",{class:"tabs",key:t.name},[_(H,{active:A.value[E],"onUpdate:active":p=>A.value[E]=p,onChange:T,role:""},{default:u(()=>[(n(!0),f(C,null,w(t.list,p=>(n(),x(G,{key:p.classifyId},{title:u(()=>[s("span",null,R(p.classifyName=="全部"?"最近上传":p.classifyName),1)]),_:2},1024))),128))]),_:2},1032,["active","onUpdate:active"])]))),128)),s("div",ne,[_(F,{loading:r.value,"onUpdate:loading":a[0]||(a[0]=t=>r.value=t),"immediate-check":!1,finished:d.value,error:h.value,"onUpdate:error":a[1]||(a[1]=t=>h.value=t),"error-text":"请求失败，点击重新加载","finished-text":"没有更多了",onLoad:N,class:"list",role:""},{default:u(()=>[_(q,{gutter:"10"},{default:u(()=>[(n(!0),f(C,null,w(i.value,t=>(n(),x(X,{key:t.id,span:"8"},{default:u(()=>[t.shortId?(n(),x(ee,{key:0,MvItem:t,islist:!1},null,8,["MvItem"])):j("",!0)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","finished","error"])])])]),_:1},8,["modelValue"])],544)])])])}}}),Ce=J(ie,[["__scopeId","data-v-8d16f5d3"]]);export{Ce as default};
