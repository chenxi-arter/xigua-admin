import{d as S,r as v,o as E,p as d,a as h,q as k,E as y,F as $,s as I,y as a,U as V,k as z,z as B,X as D,v as n,R as N,_ as T,S as F}from"./index-7PhDHdT4.js";import{T as G,a as P}from"./index-DAV5sliP.js";import"./index-WORDRJPu.js";import{N as q}from"./index-CFevCZnb.js";import{P as A}from"./index-kdNEkN-O.js";import{L as X}from"./index-CBQR5_gg.js";import{E as j}from"./index-D40m_90T.js";import"./use-id-qBLgsE0w.js";import"./use-route-B3hORbfJ.js";import"./use-placeholder-qSoBQuC3.js";const H="/static/img/1.png",J={class:"msg-space"},K=["onClick"],O={class:"badge-box"},Q={class:"item-medi"},W={class:"nickname"},Y={class:"info"},Z={key:0},ee={key:1},te={class:"time"},se={class:"item-right"},ae=["src"],oe=S({__name:"MsgComp",props:{active:{}},setup(U){const i=v(!1),r=v(!1),m=v(!1),l=v([]),c=U,g=async()=>{let e="";c.active==0?e="/api/notifications/unread":c.active==1?e="/api/video/episode/my-unread-replies":c.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(l.value.length/20)+1;try{const o=await N.get(e,{params:{page:s,size:20}}),u=o.data.data.list||o.data.list;l.value.push(...u),u.length<20&&(r.value=!0)}catch(o){console.error(o)}},f=async()=>{await g(),i.value=!1},w=async()=>{l.value=[],r.value=!1,i.value=!0,await f(),m.value=!1},b=e=>{const s=new Date(e),u=new Date().getTime()-s.getTime(),C=Math.floor(u/1e3),_=Math.floor(C/60),t=Math.floor(_/60),R=Math.floor(t/24);return R>0?`${R}天前`:t>0?`${t}小时前`:_>0?`${_}分钟前`:"刚刚"},M=async e=>{const s="/api/video/episode/replies/mark-read";try{await N.post(s,{replyIds:[e]})}catch(o){console.error(o)}},p=async e=>{const s="/api/video/comment/likes/mark-read";try{await N.post(s,{replyIds:[e]})}catch(o){console.error(o)}},x=E(),L=async e=>{c.active==1||e.type=="reply"?await M(e.id):(c.active==2||e.type=="like")&&await p(e.id),e.isRead=!0,x.fetchUnread(),D.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const o=j,u=z,C=X,_=A;return n(),d("div",J,[h(_,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),onRefresh:w},{default:k(()=>[r.value&&l.value.length==0?(n(),y(o,{key:0,"image-size":"100",description:"暂无内容"})):(n(),y(C,{key:1,loading:i.value,"onUpdate:loading":s[0]||(s[0]=t=>i.value=t),finished:r.value,"finished-text":"没有更多了",onLoad:f},{default:k(()=>[(n(!0),d($,null,I(l.value,t=>(n(),d("div",{class:"msg-item",key:t.id,onClick:R=>L(t)},[a("div",O,[t.isRead?V("",!0):(n(),y(u,{key:0,dot:""}))]),s[4]||(s[4]=a("div",{class:"item-left"},[a("img",{src:H,alt:""})],-1)),a("div",Q,[a("div",W,B(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),a("div",Y,[e.active==1||t.type=="reply"?(n(),d("div",Z,[s[2]||(s[2]=a("span",null,"评论了你:",-1)),a("span",null,B(t.content),1)])):e.active==2||t.type=="like"?(n(),d("div",ee,s[3]||(s[3]=[a("span",null,"点赞了你的评论",-1)]))):V("",!0),a("span",te,B(b(t.createdAt)),1)])]),a("div",se,[a("img",{src:t.seriesCoverUrl,alt:""},null,8,ae)])],8,K))),128))]),_:1},8,["loading","finished"]))]),_:1},8,["modelValue"])])}}}),ne=T(oe,[["__scopeId","data-v-ac768b8b"]]),ie=S({__name:"MessageView",setup(U){const i=F(),r=v(0),m=v(["全部","评论","点赞"]),l=()=>{c()},c=()=>{i.options.history.state?.back!==null?i.back():i.push("/")};return(g,f)=>{const w=q,b=P,M=G;return n(),d("div",null,[h(w,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:l}),h(M,{active:r.value,"onUpdate:active":f[0]||(f[0]=p=>r.value=p),shrink:"","line-width":"3vw",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:k(()=>[(n(!0),d($,null,I(m.value,p=>(n(),y(b,{title:p,key:p},{default:k(()=>[h(ne,{active:r.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),he=T(ie,[["__scopeId","data-v-9b6106ca"]]);export{he as default};
