import{g as R,r as i,R as N,H as ne,E as A,d as Y,c as v,Y as j,T as K,h as F,v as M,m as z,a as ae,n as se,l as le,F as ce,q as re,L as ie}from"./index-7FOGszME.js";import{e as x,t as P,j as X,n as k,a4 as D,Q as ue,a5 as de,h as $,c as H,A as G,g as ve,C as U,w as V,f as g,a as fe,L as ye,I as he,a6 as me}from"./index-ClyqnePh.js";function Ie(e){const t=R();t&&x(t.proxy,e)}let Oe=2e3;const Ce=()=>++Oe,Z={show:Boolean,zIndex:k,overlay:P,duration:k,teleport:[String,Object],lockScroll:P,lazyRender:P,beforeClose:Function,overlayProps:Object,overlayStyle:Object,overlayClass:X,transitionAppear:Boolean,closeOnClickOverlay:P},Le=Object.keys(Z);function Pe(e,t){return e>t?"horizontal":t>e?"vertical":""}function be(){const e=i(0),t=i(0),o=i(0),r=i(0),s=i(0),l=i(0),c=i(""),n=i(!0),f=()=>c.value==="vertical",C=()=>c.value==="horizontal",u=()=>{o.value=0,r.value=0,s.value=0,l.value=0,c.value="",n.value=!0};return{move:d=>{const y=d.touches[0];o.value=(y.clientX<0?0:y.clientX)-e.value,r.value=y.clientY-t.value,s.value=Math.abs(o.value),l.value=Math.abs(r.value);const O=10;(!c.value||s.value<O&&l.value<O)&&(c.value=Pe(s.value,l.value)),n.value&&(s.value>D||l.value>D)&&(n.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:r,offsetX:s,offsetY:l,direction:c,isVertical:f,isHorizontal:C,isTap:n}}let b=0;const L="van-overflow-hidden";function we(e,t){const o=be(),r="01",s="10",l=u=>{o.move(u);const I=o.deltaY.value>0?s:r,w=de(u.target,e.value),{scrollHeight:d,offsetHeight:y,scrollTop:O}=w;let h="11";O===0?h=y>=d?"00":"01":O+y>=d&&(h="10"),h!=="11"&&o.isVertical()&&!(parseInt(h,2)&parseInt(I,2))&&$(u,!0)},c=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",l,{passive:!1}),b||document.body.classList.add(L),b++},n=()=>{b&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",l),b--,b||document.body.classList.remove(L))},f=()=>t()&&c(),C=()=>t()&&n();ue(f),N(C),ne(C),A(t,u=>{u?c():n()})}function q(e){const t=i(!1);return A(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const p=()=>{var e;const{scopeId:t}=((e=R())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[Se,ke]=H("overlay"),xe={show:Boolean,zIndex:k,duration:k,className:X,lockScroll:P,lazyRender:P,customStyle:Object,teleport:[String,Object]};var Te=Y({name:Se,inheritAttrs:!1,props:xe,setup(e,{attrs:t,slots:o}){const r=i(),s=q(()=>e.show||!e.lazyRender),l=n=>{e.lockScroll&&$(n,!0)},c=s(()=>{var n;const f=x(ve(e.zIndex),e.customStyle);return U(e.duration)&&(f.animationDuration=`${e.duration}s`),F(v("div",z({ref:r,style:f,class:[ke(),e.className]},t),[(n=o.default)==null?void 0:n.call(o)]),[[M,e.show]])});return G("touchmove",l,{target:r}),()=>{const n=v(j,{name:"van-fade",appear:!0},{default:c});return e.teleport?v(K,{to:e.teleport},{default:()=>[n]}):n}}});const ge=V(Te),ze=x({},Z,{round:Boolean,position:g("center"),closeIcon:g("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:g("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ae,B]=H("popup");var Ee=Y({name:Ae,inheritAttrs:!1,props:ze,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:r}){let s,l;const c=i(),n=i(),f=q(()=>e.show||!e.lazyRender),C=ae(()=>{const a={zIndex:c.value};if(U(e.duration)){const m=e.position==="center"?"animationDuration":"transitionDuration";a[m]=`${e.duration}s`}return a}),u=()=>{s||(s=!0,c.value=e.zIndex!==void 0?+e.zIndex:Ce(),t("open"))},I=()=>{s&&fe(e.beforeClose,{done(){s=!1,t("close"),t("update:show",!1)}})},w=a=>{t("clickOverlay",a),e.closeOnClickOverlay&&I()},d=()=>{if(e.overlay){const a=x({show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},e.overlayProps);return v(ge,z(a,p(),{onClick:w}),{default:r["overlay-content"]})}},y=a=>{t("clickCloseIcon",a),I()},O=()=>{if(e.closeable)return v(he,{role:"button",tabindex:0,name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),ye],classPrefix:e.iconPrefix,onClick:y},null)};let h;const Q=()=>{h&&clearTimeout(h),h=setTimeout(()=>{t("opened")})},W=()=>t("closed"),J=a=>t("keydown",a),ee=f(()=>{var a;const{destroyOnClose:m,round:T,position:S,safeAreaInsetTop:te,safeAreaInsetBottom:oe,show:_}=e;if(!(!_&&m))return F(v("div",z({ref:n,style:C.value,role:"dialog",tabindex:0,class:[B({round:T,[S]:S}),{"van-safe-area-top":te,"van-safe-area-bottom":oe}],onKeydown:J},o,p()),[(a=r.default)==null?void 0:a.call(r),O()]),[[M,_]])}),E=()=>{const{position:a,transition:m,transitionAppear:T}=e,S=a==="center"?"van-fade":`van-popup-slide-${a}`;return v(j,{name:m||S,appear:T,onAfterEnter:Q,onAfterLeave:W},{default:ee})};return A(()=>e.show,a=>{a&&!s&&(u(),o.tabindex===0&&re(()=>{var m;(m=n.value)==null||m.focus()})),!a&&s&&(s=!1,t("close"))}),Ie({popupRef:n}),we(n,()=>e.show&&e.lockScroll),G("popstate",()=>{e.closeOnPopstate&&(I(),l=!1)}),se(()=>{e.show&&u()}),le(()=>{l&&(t("update:show",!0),l=!1)}),N(()=>{e.show&&e.teleport&&(I(),l=!0)}),ie(me,()=>e.show),()=>e.teleport?v(K,{to:e.teleport},{default:()=>[d(),E()]}):v(ce,null,[d(),E()])}});const pe=V(Ee);export{pe as P,p as a,Le as b,be as c,Z as p,Ie as u};
