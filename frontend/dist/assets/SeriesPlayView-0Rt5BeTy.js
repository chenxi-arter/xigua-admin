const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DrzLh-fh.js","assets/index-OOe-qU7w.js","assets/index-B-NUcGvg.js","assets/index-ys9dfDTb.css","assets/index-DIRquChx.js","assets/use-route-8j7D0a9D.js","assets/request-BicgVeyS.js","assets/index-CjAwa605.css","assets/index-BPtAGNlc.js","assets/index-C0snIXTB.js","assets/index-IkYTGXlt.js","assets/CommentDrawer-CnAEiFTH.js","assets/index.min-BmcZ0e5Q.js","assets/index-BjiV7Ugf.css","assets/index-DIE1r4Zn.js","assets/index-BzrbYvYM.css","assets/use-id-D_qdaRVJ.js","assets/CommentDrawer-C2S8Xhu0.css","assets/index-6lGa7cvQ.js","assets/index-CgTBkkhk.js","assets/index-UNMXo3RX.js","assets/use-placeholder-DRhrQcfx.js","assets/index-OmoyC3jg.js","assets/index-s1SJ6FBO.js","assets/index-BrrjYSyC.js","assets/index-ClKFl5eT.js","assets/index-uDKQMKZJ.js"])))=>i.map(i=>d[i]);
import{d as j,r as n,w as B,j as O,x as U,p as ee,a as s,b as w,c as S,k as P,A as y,l as se,q as G,F as oe,n as te,M as ae,o as I,_ as J,D as ne,h as ie,t as re,u as le}from"./index-B-NUcGvg.js";import{V as ue,C as de}from"./CommentDrawer-CnAEiFTH.js";import{L as ce}from"./index-DIE1r4Zn.js";import{P as K,c as N,s as c}from"./request-BicgVeyS.js";import{I as Q}from"./index-OOe-qU7w.js";import"./index.min-BmcZ0e5Q.js";import"./index-DIRquChx.js";import"./use-route-8j7D0a9D.js";import"./use-id-D_qdaRVJ.js";const ve={class:"episode-selector"},pe={class:"selector-header"},he={class:"header-info"},fe={key:0},me={class:"episode-grid"},_e=["onClick"],ge={class:"episode-number"},we={key:0,class:"watched-indicator"},ye={class:"selector-footer"},Ie=j({__name:"EpisodeSelector",props:{visible:{type:Boolean},seriesShortId:{},currentEpisodeShortId:{},currentEpisode:{}},emits:["update:visible","select"],setup(W,{emit:C}){const v=W,b=C,i=n([]),m=n(0),e=n(!1),r=n(!1),_=n(1),z=n(40),k=n(!0),E=n(null),x=async(o=1,g=!1)=>{try{e.value=!0,console.log("ðŸ” åŠ è½½å‰§é›†åˆ—è¡¨:",{seriesShortId:v.seriesShortId,page:o,size:z.value,append:g});const l=await N.get("/api/video/episodes",{params:{seriesShortId:v.seriesShortId,page:o,size:z.value}});console.log("ðŸ“¦ å‰§é›†å“åº”:",l.data);const p=l.data.data,h=p.list||[];console.log("ðŸ“ æ–°åŠ è½½å‰§é›†:",{æ•°é‡:h.length,æ€»é›†æ•°:p.total,è¿˜æœ‰æ›´å¤š:p.hasMore,å½“å‰é¡µ:o});const u=k.value?h:[...h].reverse();g?i.value=[...i.value,...u]:i.value=u,m.value=p.total,r.value=!p.hasMore,console.log("âœ… å‰§é›†åŠ è½½å®Œæˆ:",{å½“å‰æ€»æ•°:i.value.length,æ€»é›†æ•°:m.value,å·²å®Œæˆ:r.value}),o===1&&v.currentEpisodeShortId&&(await te(),A())}catch(l){console.error("âŒ åŠ è½½å‰§é›†åˆ—è¡¨å¤±è´¥:",l);const p=l,{showToast:h}=await ae(async()=>{const{showToast:u}=await import("./index-DrzLh-fh.js");return{showToast:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]));h(p.response?.data?.message||"åŠ è½½å‰§é›†å¤±è´¥"),r.value=!0}finally{e.value=!1}},F=async()=>{if(console.log("ðŸ“„ è§¦å‘åŠ è½½æ›´å¤š:",{finished:r.value,currentPage:_.value,å½“å‰å‰§é›†æ•°:i.value.length}),r.value){console.log("â¸ï¸ å·²åŠ è½½å®Œæ‰€æœ‰æ•°æ®");return}_.value++,await x(_.value,!0)},L=o=>{b("select",o),V()},$=o=>{b("update:visible",o)},V=()=>{b("update:visible",!1)},M=async()=>{k.value=!k.value,_.value=1,r.value=!1,await x(1,!1)},R=()=>{const o=window.innerWidth;return o>=1200?"80%":o>=1024?"75%":o>=768?"70%":"60%"},A=()=>{if(!E.value||!v.currentEpisodeShortId)return;const o=i.value.findIndex(g=>g.shortId===v.currentEpisodeShortId);if(o!==-1){const l=D(),h=Math.floor(o/l)*48;E.value.scrollTop=h}},D=()=>{const o=window.innerWidth;return o>=1200?10:o>=1024?8:o>=768?6:4};return B(()=>v.visible,async o=>{o?(console.log("ðŸŽ¬ æ‰“å¼€é€‰é›†å¼¹çª—:",{seriesShortId:v.seriesShortId,currentEpisode:v.currentEpisode}),i.value=[],_.value=1,r.value=!1,await x(1,!1)):console.log("ðŸ”’ å…³é—­é€‰é›†å¼¹çª—")}),(o,g)=>{const l=Q,p=ce,h=K;return I(),O(h,{show:o.visible,"onUpdate:show":$,position:"bottom",style:ee({height:R()}),round:"",onClose:V},{default:U(()=>[s("div",ve,[s("div",pe,[g[1]||(g[1]=s("div",{class:"header-title"},"é€‰é›†",-1)),s("div",he,[s("span",null,"å…±"+y(m.value)+"é›†",1),o.currentEpisode?(I(),S("span",fe,"Â· æ­£åœ¨æ’­æ”¾ç¬¬"+y(o.currentEpisode)+"é›†",1)):P("",!0)]),w(l,{name:"cross",class:"close-icon",onClick:V})]),s("div",{class:"episode-list",ref_key:"listContainer",ref:E},[w(p,{loading:e.value,"onUpdate:loading":g[0]||(g[0]=u=>e.value=u),finished:r.value,"finished-text":"æ²¡æœ‰æ›´å¤šäº†",onLoad:F},{default:U(()=>[s("div",me,[(I(!0),S(oe,null,se(i.value,u=>(I(),S("div",{key:u.shortId,class:G(["episode-item",{active:o.currentEpisodeShortId===u.shortId,watched:u.isWatched}]),onClick:H=>L(u)},[s("div",ge,y(u.episodeTitle),1),u.isWatched?(I(),S("div",we,[w(l,{name:"success"})])):P("",!0)],10,_e))),128))])]),_:1},8,["loading","finished"])],512),s("div",ye,[s("div",{class:"sort-btn",onClick:M},[w(l,{name:k.value?"descending":"ascending"},null,8,["name"]),s("span",null,y(k.value?"æ­£åº":"å€’åº"),1)])])])]),_:1},8,["show","style"])}}}),be=J(Ie,[["__scopeId","data-v-948be349"]]),ke={class:"series-play-container"},Se={class:"player-wrapper"},Ce={class:"custom-top-bar"},Ee={class:"top-left"},xe={class:"bottom-actions"},Pe={class:"info-drawer"},Ve={class:"series-info-content"},Ne={class:"series-title"},$e={key:0,class:"description-section"},ze={class:"description-text"},Le={class:"info-list"},Te={key:0,class:"info-item"},Fe={class:"info-value"},Me={key:1,class:"info-item"},Re={class:"info-value"},Ae={key:2,class:"info-item"},De={class:"info-value"},qe=j({__name:"SeriesPlayView",setup(W){const C=re(),v=le(),b=n(""),i=n(null),m=n([]),e=n(null),r=n(1),_=n(0),z=n(null),k=n(!1),E=n(!1),x=ne(()=>r.value<_.value),F=()=>{v.back()},L=async()=>{try{if(m.value=[],e.value=null,i.value=null,r.value=1,_.value=0,!localStorage.getItem("Authorization")){c("è¯·å…ˆç™»å½•"),v.push("/login");return}const d=(await N.get("/api/video/episodes",{params:{seriesShortId:b.value,page:1,size:200}})).data.data;i.value=d.seriesInfo,m.value=d.list||[],_.value=d.total;const T=C.query.episodeId;if(T){const f=m.value.find(q=>q.shortId===T);f?(e.value=f,r.value=f.episodeNumber):$()}else if(d.userProgress&&d.userProgress.currentEpisodeShortId){const f=m.value.find(q=>q.shortId===d.userProgress.currentEpisodeShortId);f?(e.value=f,r.value=f.episodeNumber):$()}else $()}catch(a){console.error("åŠ è½½ç³»åˆ—æ•°æ®å¤±è´¥:",a),c("åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}},$=()=>{m.value.length>0&&(e.value=m.value[0],r.value=m.value[0].episodeNumber)},V=()=>{if(!x.value){c("å·²ç»æ˜¯æœ€åŽä¸€é›†äº†");return}const a=m.value.find(t=>t.episodeNumber===r.value+1);a&&(e.value=a,r.value=a.episodeNumber,v.replace({query:{...C.query,episodeId:a.shortId}}))},M=()=>{x.value?setTimeout(()=>{V()},1e3):c("å·²æ’­æ”¾å®Œæ‰€æœ‰å‰§é›†")},R=()=>{E.value=!0},A=()=>{k.value=!0},D=a=>{e.value=a,r.value=a.episodeNumber,v.replace({query:{...C.query,episodeId:a.shortId}})},o=async()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){c("è¯·å…ˆç™»å½•");return}try{await N.post("/api/video/episode/activity",{shortId:e.value.shortId,type:"like"}),e.value.isLiked?(e.value.likeCount=Math.max(0,(e.value.likeCount||0)-1),e.value.isLiked=!1,c("å·²å–æ¶ˆç‚¹èµž")):(e.value.likeCount=(e.value.likeCount||0)+1,e.value.isLiked=!0,c("ç‚¹èµžæˆåŠŸ"))}catch(t){console.error("ç‚¹èµžæ“ä½œå¤±è´¥:",t),c(t.response?.data?.message||"æ“ä½œå¤±è´¥")}},g=async()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){c("è¯·å…ˆç™»å½•");return}try{e.value.isFavorited?(await N.post("/api/user/favorites/remove",{shortId:e.value.shortId}),e.value.favoriteCount=Math.max(0,(e.value.favoriteCount||0)-1),e.value.isFavorited=!1,c("å·²å–æ¶ˆæ”¶è—")):(await N.post("/api/video/episode/activity",{shortId:e.value.shortId,type:"favorite"}),e.value.favoriteCount=(e.value.favoriteCount||0)+1,e.value.isFavorited=!0,c("æ”¶è—æˆåŠŸ"))}catch(t){console.error("æ”¶è—æ“ä½œå¤±è´¥:",t),c(t.response?.data?.message||"æ“ä½œå¤±è´¥")}},l=n(!1),p=n(""),h=n(0),u=()=>{if(!e.value)return;if(!localStorage.getItem("Authorization")){c("è¯·å…ˆç™»å½•");return}p.value=e.value.shortId,h.value=e.value.commentCount||0,l.value=!0},H=()=>{e.value&&(e.value.commentCount=(e.value.commentCount||0)+1,h.value=e.value.commentCount)},X=()=>{c("åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­")},Y=()=>{};ie(()=>{if(b.value=C.params.id,!b.value){c("å‚æ•°é”™è¯¯"),v.back();return}L()}),B(()=>C.params.id,a=>{a&&a!==b.value&&(b.value=a,L())},{immediate:!1}),B(e,a=>{a&&Z(a.shortId,0)});const Z=async(a,t)=>{try{await N.post("/api/video/progress",{episodeIdentifier:a,stopAtSecond:t})}catch(d){console.error("ä¿å­˜è§‚çœ‹è¿›åº¦å¤±è´¥:",d)}};return(a,t)=>{const d=Q,T=K;return I(),S("div",ke,[s("div",Se,[e.value?(I(),O(ue,{key:0,ref_key:"playerRef",ref:z,"episode-info":e.value,autoplay:!0,muted:!1,"show-view-series-button":!1,onEnded:M,onLike:o,onFavorite:g,onComment:u,onShare:X,onViewSeries:Y},null,8,["episode-info"])):P("",!0),s("div",Ce,[s("div",Ee,[w(d,{name:"arrow-left",onClick:F})])]),s("div",xe,[s("div",{class:"action-btn info-btn",onClick:R},[w(d,{name:"info-o"}),t[3]||(t[3]=s("span",null,"ç®€ä»‹",-1))]),s("div",{class:"action-btn episodes-btn",onClick:A},[w(d,{name:"apps-o"}),s("span",null,"é€‰é›† "+y(r.value)+"/"+y(_.value),1)]),s("div",{class:G(["action-btn next-btn",{disabled:!x.value}]),onClick:V},[t[4]||(t[4]=s("span",null,"ä¸‹ä¸€é›†",-1)),w(d,{name:"arrow"})],2)])]),w(be,{visible:k.value,"onUpdate:visible":t[0]||(t[0]=f=>k.value=f),"series-short-id":b.value,"current-episode-short-id":e.value?.shortId,"current-episode":r.value,onSelect:D},null,8,["visible","series-short-id","current-episode-short-id","current-episode"]),w(T,{show:E.value,"onUpdate:show":t[1]||(t[1]=f=>E.value=f),position:"bottom",style:{height:"70vh",maxHeight:"calc(70vh + env(safe-area-inset-bottom))",borderRadius:"16px 16px 0 0"},closeable:"","close-icon-position":"top-right"},{default:U(()=>[s("div",Pe,[s("div",Ve,[s("div",Ne,y(i.value?.title),1),i.value?.description?(I(),S("div",$e,[s("p",ze,y(i.value.description),1)])):P("",!0),s("div",Le,[i.value?.starring?(I(),S("div",Te,[t[5]||(t[5]=s("span",{class:"info-label"},"ä¸»æ¼”ï¼š",-1)),s("span",Fe,y(i.value.starring),1)])):P("",!0),_.value?(I(),S("div",Me,[t[6]||(t[6]=s("span",{class:"info-label"},"é›†æ•°ï¼š",-1)),s("span",Re,"å…¨"+y(_.value)+"é›†",1)])):P("",!0),i.value?.tags&&i.value.tags.length?(I(),S("div",Ae,[t[7]||(t[7]=s("span",{class:"info-label"},"æ ‡ç­¾ï¼š",-1)),s("span",De,y(i.value.tags.join(" Â· ")),1)])):P("",!0)])])])]),_:1},8,["show"]),w(de,{visible:l.value,"onUpdate:visible":t[2]||(t[2]=f=>l.value=f),"episode-short-id":p.value,"comment-count":h.value,onCommented:H},null,8,["visible","episode-short-id","comment-count"])])}}}),Qe=J(qe,[["__scopeId","data-v-8495d191"]]);export{Qe as default};
