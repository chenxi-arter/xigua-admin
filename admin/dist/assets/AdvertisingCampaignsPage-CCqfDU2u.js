import{I as v,j as e}from"./index-DQ28UZMZ.js";import{r as l}from"./react-vendor-BZ8KDC-J.js";import{G as Ne,H as Ue,P as Ke,F as m,s as i,u as We,b as he,d as P,I as x,R as S,C as f,f as U,v as fe,l as W,a as O,B as h,J as qe,o as He,m as A,r as M,x as L,K as Je,g as ge,N as pe,i as Ge,j as Qe,T as $,O as xe}from"./antd-vendor-aNvYRewR.js";import{A as Y,d as Xe,e as N}from"./admin-DADjyHSf.js";import{R as je}from"./EyeOutlined-Cvn49ah2.js";import{R as q}from"./ReloadOutlined-lAZvq3vX.js";import{R as Ze}from"./CopyOutlined-BXth_Gss.js";import"./client-BbHh6MVO.js";import"./utils-vendor-NIGUFBhG.js";var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"};function G(){return G=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},G.apply(this,arguments)}const tt=(n,r)=>l.createElement(v,G({},n,{ref:r,icon:et})),ye=l.forwardRef(tt);function Q(){return Q=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},Q.apply(this,arguments)}const st=(n,r)=>l.createElement(v,Q({},n,{ref:r,icon:Ne})),ve=l.forwardRef(st);function X(){return X=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},X.apply(this,arguments)}const rt=(n,r)=>l.createElement(v,X({},n,{ref:r,icon:Ue})),be=l.forwardRef(rt);var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};function Z(){return Z=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},Z.apply(this,arguments)}const nt=(n,r)=>l.createElement(v,Z({},n,{ref:r,icon:at})),lt=l.forwardRef(nt);var ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};function ee(){return ee=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},ee.apply(this,arguments)}const it=(n,r)=>l.createElement(v,ee({},n,{ref:r,icon:ot})),ct=l.forwardRef(it);var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};function te(){return te=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},te.apply(this,arguments)}const ut=(n,r)=>l.createElement(v,te({},n,{ref:r,icon:dt})),Ce=l.forwardRef(ut);function se(){return se=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},se.apply(this,arguments)}const mt=(n,r)=>l.createElement(v,se({},n,{ref:r,icon:Ke})),H=l.forwardRef(mt);var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"};function re(){return re=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n},re.apply(this,arguments)}const ft=(n,r)=>l.createElement(v,re({},n,{ref:r,icon:ht})),gt=l.forwardRef(ft),{Search:pt}=x,{Option:J}=U,{Text:k}=Ge,we=[{label:"草稿",value:"draft",color:"default"},{label:"投放中",value:"active",color:"success"},{label:"已暂停",value:"paused",color:"warning"},{label:"已完成",value:"completed",color:"processing"},{label:"已取消",value:"cancelled",color:"error"}],Rt=()=>{const[n,r]=l.useState([]),[a,o]=l.useState([]),[R,ae]=l.useState(null),[ne,le]=l.useState(!1),[oe,ie]=l.useState(null),[Se,ce]=l.useState(!1),[Oe,E]=l.useState(!1),[b,D]=l.useState(null),[de,K]=l.useState(!1),[C]=m.useForm(),[Re,Ee]=l.useState("campaigns"),[De,z]=l.useState(!1),[_,T]=l.useState(null),[I]=m.useForm(),[ue]=l.useState(!1),[u,F]=l.useState({keyword:"",platform:"",status:"",dateRange:null}),[g,V]=l.useState({current:1,pageSize:20,total:0}),B=async()=>{console.log("[loadPlatforms] 开始加载平台列表");try{const t=await N.list({enabled:!0});console.log("[loadPlatforms] 平台列表加载成功",t.data),o(t.data||[])}catch(t){console.error("[loadPlatforms] 加载平台列表失败:",t),(t.code==="ECONNREFUSED"||t.response?.status===404)&&o([{id:1,name:"抖音",code:"tiktok",color:"#ff0050",isEnabled:!0,sortOrder:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:2,name:"微信",code:"wechat",color:"#07c160",isEnabled:!0,sortOrder:2,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:3,name:"百度",code:"baidu",color:"#2932e1",isEnabled:!0,sortOrder:3,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}])}},j=l.useCallback(async()=>{console.log("[loadCampaigns] 开始加载投放计划",{platformsCount:a.length,pagination:g,filters:u}),le(!0),ie(null);try{const t={keyword:u.keyword||void 0,platform:u.platform||void 0,status:u.status||void 0};u.dateRange&&(t.startDate=u.dateRange[0].format("YYYY-MM-DD"),t.endDate=u.dateRange[1].format("YYYY-MM-DD")),console.log("[loadCampaigns] 请求参数",{page:g.current,size:g.pageSize,params:t});const s=await Y.list(g.current,g.pageSize,t);console.log("[loadCampaigns] API响应",s);const c=(s.data?.items||[]).map(d=>{const p=a.find(y=>y.code===d.platform);return{...d,platformCode:d.platform,platformId:p?.id||0}});console.log("[loadCampaigns] 处理后的数据",{count:c.length,total:s.data?.total}),r(c),V(d=>({...d,total:s.data?.total||0}))}catch(t){console.error("加载投放计划失败:",t);let s="";t.code==="ECONNABORTED"||t.message?.includes("timeout")?(s="请求超时，数据加载时间过长",i.error({content:s+"。请检查网络连接或稍后重试",duration:5})):t.code==="ERR_NETWORK"?(s="网络连接失败",i.error({content:s+"，请检查后端服务是否正常运行",duration:5})):t.response?.status===404?(s="投放计划API接口不存在",i.error(s)):t.response?.status>=500?(s="服务器错误",i.error(s+"，请稍后重试")):(s=t.message||"加载失败",i.error(`加载失败: ${s}`)),ie(s),r([]),V(c=>({...c,total:0}))}finally{le(!1)}},[a,u.keyword,u.platform,u.status,u.dateRange,g.current,g.pageSize]),w=l.useCallback(async()=>{ce(!0);try{const t={};u.dateRange&&(t.from=u.dateRange[0].format("YYYY-MM-DD"),t.to=u.dateRange[1].format("YYYY-MM-DD"));const s=await Xe.overview(t);ae(s)}catch(t){console.error("加载仪表盘数据失败:",t),ae({totalCampaigns:0,activeCampaigns:0,totalSpend:0,totalClicks:0,totalConversions:0,avgConversionRate:0,platformStats:[],recentEvents:[]}),t.code==="ECONNABORTED"||t.message?.includes("timeout")?i.warning({content:"仪表盘数据加载超时，显示默认数据",duration:3}):t.code!=="ERR_NETWORK"&&i.warning("仪表盘数据加载失败，显示默认数据")}finally{ce(!1)}},[u.dateRange]);l.useEffect(()=>{B()},[]),l.useEffect(()=>{a.length>0&&(console.log("[useEffect] 加载投放计划和仪表盘数据",{platformsCount:a.length,pagination:g,filters:u}),j(),w())},[a.length,j,w]);const Ie=async t=>{if(de){console.log("[handleSubmit] 正在提交中，忽略重复请求");return}K(!0);try{console.log("[handleSubmit] 开始提交表单",{values:t,editingCampaign:b});const s=a.find(d=>d.id===t.platformId);if(!s){i.error("请选择有效的投放平台");return}const c={name:t.name,description:t.description,platform:s.code,targetUrl:t.targetUrl,startDate:t.startDate.format("YYYY-MM-DD"),endDate:t.endDate?.format("YYYY-MM-DD")};if(console.log("[handleSubmit] 准备发送的数据",{payload:c,isEditing:!!b}),b){console.log("[handleSubmit] 更新投放计划",b.id);const d=await Y.update(b.id,c);console.log("[handleSubmit] 更新成功",d),i.success("投放计划更新成功")}else{console.log("[handleSubmit] 创建投放计划");const d=await Y.create(c);console.log("[handleSubmit] 创建成功",d),i.success("投放计划创建成功")}E(!1),D(null),C.resetFields(),j(),w()}catch(s){K(!1),console.error("[handleSubmit] 保存投放计划失败:",s),console.error("[handleSubmit] 错误详情:",{message:s.message,response:s.response,code:s.code,stack:s.stack}),s.response?.data?.message?i.error(`保存失败: ${s.response.data.message}`):s.code==="ERR_NETWORK"?i.error("网络连接失败，请检查后端服务"):i.error(`保存投放计划失败: ${s.message||"未知错误"}`)}finally{K(!1)}},Pe=async t=>{try{await Y.remove(t),i.success("投放计划删除成功"),j(),w()}catch(s){console.error("删除投放计划失败:",s),i.error("删除投放计划失败")}},me=async(t,s)=>{try{await Y.updateStatus(t,s),i.success("状态更新成功"),j(),w()}catch(c){console.error("状态更新失败:",c),i.error("状态更新失败")}},$e=t=>{if(!t.targetUrl){i.error("目标链接不存在");return}const s=t.platformCode||t.platform||"unknown",c=t.campaignCode||`${s}_${t.id}`,d=t.targetUrl.includes("t.me/");let p;if(d){const y=`utm_campaign=${c}&utm_source=${s}`;p=`${t.targetUrl}?startapp=__tgad___${y}`}else{let y=t.targetUrl;y.endsWith("/")&&(y=y.slice(0,-1)),p=`${y}/tgad?utm_campaign=${c}&utm_source=${s}`}navigator.clipboard.writeText(p).then(()=>{i.success("投放链接已复制到剪贴板")}).catch(()=>{i.error("复制失败")})},ke=t=>{try{console.log("[handleEdit] 开始编辑投放计划",t),D(t);const s=t.startDate?P(t.startDate):null,c=t.endDate?P(t.endDate):null,d={name:t.name,description:t.description,platformId:t.platformId,targetUrl:t.targetUrl,startDate:s||void 0,endDate:c||void 0};console.log("[handleEdit] 设置表单值",d),C.setFieldsValue(d),E(!0),console.log("[handleEdit] 编辑模态框已打开")}catch(s){console.error("[handleEdit] 编辑表单设置失败:",s),i.error(`打开编辑表单失败: ${s instanceof Error?s.message:"未知错误"}`)}},ze=()=>{T(null),I.resetFields(),z(!0)},Te=t=>{T(t),I.setFieldsValue({name:t.name,code:t.code,description:t.description,color:t.color,isEnabled:t.isEnabled,sortOrder:t.sortOrder}),z(!0)},Ae=async t=>{try{await N.remove(t),i.success("平台删除成功"),B()}catch(s){console.error("删除平台失败:",s),s.response?.status===409?i.error("无法删除该平台：该平台正在被投放计划使用，请先删除相关的投放计划"):s.response?.data?.message?i.error(`删除失败: ${s.response.data.message}`):s.code==="ERR_NETWORK"?i.error("网络连接失败，请检查后端服务"):i.error(`删除平台失败: ${s.message}`)}},Me=async t=>{try{const s={name:t.name,code:t.code,description:t.description,color:typeof t.color=="string"?t.color:t.color?.toHexString?.()||"#1890ff",isEnabled:t.isEnabled??!0,sortOrder:t.sortOrder||0};_?(await N.update(_.id,s),i.success("平台更新成功")):(await N.create(s),i.success("平台创建成功")),z(!1),T(null),I.resetFields(),B()}catch(s){if(console.error("保存平台失败:",s),s.response?.data?.message)i.error(`保存失败: ${s.response.data.message}`);else if(s.response?.data?.details){const c=s.response.data.details;if(Array.isArray(c)){const d=c.map(p=>p.constraints?Object.values(p.constraints).join(", "):p).join("; ");i.error(`验证失败: ${d}`)}else i.error(`保存失败: ${JSON.stringify(c)}`)}else s.code==="ERR_NETWORK"?i.error("网络连接失败，请检查后端服务"):i.error(`保存平台失败: ${s.message}`)}},Ye=t=>a.find(c=>c.code===t)?.color||"#8c8c8c",_e=t=>{const s=we.find(c=>c.value===t);return e.jsx(L,{color:s?.color,children:s?.label})},Fe=[{title:"平台名称",dataIndex:"name",key:"name",width:150,render:(t,s)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:16,height:16,backgroundColor:s.color,borderRadius:4}}),e.jsx("span",{style:{fontWeight:500},children:t})]})},{title:"平台代码",dataIndex:"code",key:"code",width:120},{title:"描述",dataIndex:"description",key:"description",width:200,render:t=>t||"-"},{title:"状态",dataIndex:"isEnabled",key:"isEnabled",width:100,render:t=>e.jsx(L,{color:t?"success":"default",children:t?"启用":"禁用"})},{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:t=>t||0},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:t=>P(t).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"actions",width:150,render:t=>e.jsxs(O,{size:"small",children:[e.jsx(h,{type:"text",icon:e.jsx(be,{}),onClick:()=>Te(t)}),e.jsx(xe,{title:"确定要删除这个平台吗？",description:"注意：如果该平台正在被投放计划使用，将无法删除。请先删除相关的投放计划。",onConfirm:()=>Ae(t.id),okText:"确定删除",cancelText:"取消",okButtonProps:{danger:!0},children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(ve,{})})})]})}],Ve=[{title:"计划名称",dataIndex:"name",key:"name",width:200,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsx(k,{type:"secondary",style:{fontSize:12},children:s.campaignCode})]})},{title:"投放平台",key:"platform",width:100,render:t=>{const s=t.platformCode||t.platform||"",c=a.find(d=>d.code===s);return e.jsx(L,{color:Ye(s),children:c?.name||s||"未知平台"})}},{title:"状态",key:"status",width:100,render:t=>{const s=t.isActive?"active":"paused";return _e(s)}},{title:"投放时间",key:"dateRange",width:180,render:t=>e.jsxs("div",{children:[e.jsx("div",{children:P(t.startDate).format("YYYY-MM-DD")}),t.endDate&&e.jsxs(k,{type:"secondary",style:{fontSize:12},children:["至 ",P(t.endDate).format("YYYY-MM-DD")]})]})},{title:"效果数据",key:"stats",width:200,render:t=>{const s=t.stats;if(!s)return"-";const c=s.totalClicks||0,d=s.totalConversions||0,p=c>0?d/c:0;return e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs(k,{strong:!0,children:["点击: ",c.toLocaleString()]})}),e.jsxs("div",{children:[e.jsxs(k,{type:"secondary",style:{fontSize:12},children:["转化: ",d.toLocaleString()]}),e.jsx(Qe,{type:"vertical"}),e.jsxs(k,{type:"secondary",style:{fontSize:12},children:["转化率: ",(p*100).toFixed(2),"%"]})]})]})}},{title:"操作",key:"actions",width:200,render:t=>e.jsxs(O,{size:"small",children:[e.jsx($,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(je,{}),onClick:()=>{}})}),e.jsx($,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(be,{}),onClick:()=>ke(t)})}),e.jsx($,{title:"复制投放链接",children:e.jsx(h,{type:"text",icon:e.jsx(Ze,{}),onClick:()=>$e(t)})}),t.isActive?e.jsx($,{title:"暂停",children:e.jsx(h,{type:"text",icon:e.jsx(ct,{}),onClick:()=>me(t.id,"paused")})}):e.jsx($,{title:"启用",children:e.jsx(h,{type:"text",icon:e.jsx(Ce,{}),onClick:()=>me(t.id,"active")})}),e.jsx(xe,{title:"确定要删除这个投放计划吗？",onConfirm:()=>Pe(t.id),okText:"确定",cancelText:"取消",children:e.jsx($,{title:"删除",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(ve,{})})})})]})}],Be=()=>e.jsxs("div",{children:[e.jsxs(A,{style:{marginBottom:24},loading:Se,children:[e.jsxs(S,{gutter:16,children:[e.jsx(f,{span:6,children:e.jsx(M,{title:"总投放计划",value:R?.totalCampaigns||0,prefix:e.jsx(ye,{})})}),e.jsx(f,{span:6,children:e.jsx(M,{title:"活跃计划",value:R?.activeCampaigns||0,valueStyle:{color:"#3f8600"},prefix:e.jsx(Ce,{})})}),e.jsx(f,{span:6,children:e.jsx(M,{title:"总点击量",value:R?.totalClicks||0,prefix:e.jsx(je,{})})}),e.jsx(f,{span:6,children:e.jsx(M,{title:"总转化量",value:R?.totalConversions||0,valueStyle:{color:"#cf1322"}})})]}),R?.avgConversionRate!==void 0&&e.jsx(S,{gutter:16,style:{marginTop:16},children:e.jsx(f,{span:6,children:e.jsx(M,{title:"平均转化率",value:(R.avgConversionRate*100).toFixed(2),suffix:"%",precision:2})})})]}),e.jsx(A,{style:{marginBottom:24},children:e.jsxs(S,{gutter:16,align:"middle",children:[e.jsx(f,{flex:"auto",children:e.jsxs(O,{size:"middle",children:[e.jsx(pt,{placeholder:"搜索计划名称或代码",style:{width:250},value:u.keyword,onChange:t=>F(s=>({...s,keyword:t.target.value})),onSearch:()=>{V(t=>({...t,current:1})),j()}}),e.jsx(U,{placeholder:"选择平台",style:{width:120},allowClear:!0,value:u.platform||void 0,onChange:t=>F(s=>({...s,platform:t||""})),children:a.map(t=>e.jsx(J,{value:t.code,children:e.jsx(fe,{color:t.color,text:t.name})},t.code))}),e.jsx(U,{placeholder:"选择状态",style:{width:120},allowClear:!0,value:u.status||void 0,onChange:t=>F(s=>({...s,status:t||""})),children:we.map(t=>e.jsx(J,{value:t.value,children:e.jsx(L,{color:t.color,children:t.label})},t.value))}),e.jsx(W.RangePicker,{value:u.dateRange,onChange:t=>F(s=>({...s,dateRange:t})),placeholder:["开始日期","结束日期"]})]})}),e.jsx(f,{children:e.jsxs(O,{children:[e.jsx(h,{icon:e.jsx(q,{}),onClick:()=>{j(),w()},children:"刷新"}),e.jsx(h,{type:"primary",icon:e.jsx(H,{}),onClick:()=>{D(null),C.resetFields(),E(!0)},children:"新建投放计划"})]})})]})}),e.jsx(A,{children:oe&&!ne?e.jsx(Je,{status:"error",icon:e.jsx(lt,{}),title:"数据加载失败",subTitle:oe,extra:e.jsx(h,{type:"primary",icon:e.jsx(q,{}),onClick:()=>{j(),w()},children:"重新加载"})}):e.jsx(ge,{columns:Ve,dataSource:n,rowKey:"id",loading:ne,locale:{emptyText:e.jsx(pe,{description:"暂无投放计划数据",image:pe.PRESENTED_IMAGE_SIMPLE,children:e.jsx(h,{type:"primary",icon:e.jsx(H,{}),onClick:()=>{D(null),C.resetFields(),E(!0)},children:"创建第一个投放计划"})})},pagination:{current:g.current,pageSize:g.pageSize,total:g.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`,onChange:(t,s)=>{V(c=>({...c,current:t,pageSize:s||20}))}},scroll:{x:1200}})})]}),Le=()=>e.jsxs("div",{children:[e.jsx(A,{style:{marginBottom:24},children:e.jsxs(S,{gutter:16,align:"middle",children:[e.jsx(f,{flex:"auto",children:e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0},children:"平台管理"}),e.jsx(k,{type:"secondary",children:"管理广告投放平台，设置平台信息和显示样式"})]})}),e.jsx(f,{children:e.jsxs(O,{children:[e.jsx(h,{icon:e.jsx(q,{}),onClick:B,loading:ue,children:"刷新"}),e.jsx(h,{type:"primary",icon:e.jsx(H,{}),onClick:ze,children:"新建平台"})]})})]})}),e.jsx(A,{children:e.jsx(ge,{columns:Fe,dataSource:a,rowKey:"id",loading:ue,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 个平台`}})})]});return e.jsxs("div",{children:[e.jsx(We,{activeKey:Re,onChange:Ee,items:[{key:"campaigns",label:e.jsxs("span",{children:[e.jsx(ye,{}),"投放计划"]}),children:Be()},{key:"platforms",label:e.jsxs("span",{children:[e.jsx(gt,{}),"平台管理"]}),children:Le()}]}),e.jsx(he,{title:b?"编辑投放计划":"新建投放计划",open:Oe,onCancel:()=>{try{E(!1),D(null),C.resetFields()}catch(t){console.error("关闭模态框失败:",t)}},footer:null,width:600,destroyOnClose:!0,children:e.jsxs(m,{form:C,layout:"vertical",onFinish:Ie,initialValues:{startDate:P()},children:[e.jsx(m.Item,{name:"name",label:"计划名称",rules:[{required:!0,message:"请输入计划名称"}],children:e.jsx(x,{placeholder:"请输入计划名称"})}),e.jsx(m.Item,{name:"description",label:"计划描述",children:e.jsx(x.TextArea,{placeholder:"请输入计划描述",rows:3})}),e.jsx(S,{gutter:16,children:e.jsx(f,{span:12,children:e.jsx(m.Item,{name:"platformId",label:"投放平台",rules:[{required:!0,message:"请选择投放平台"}],children:e.jsx(U,{placeholder:"请选择投放平台",children:a.map(t=>e.jsx(J,{value:t.id,children:e.jsx(fe,{color:t.color,text:t.name})},t.id))})})})}),e.jsx(m.Item,{name:"targetUrl",label:"目标链接",rules:[{required:!0,message:"请输入目标链接"},{type:"url",message:"请输入有效的URL"}],children:e.jsx(x,{placeholder:"https://m.xgshort.com/"})}),e.jsxs(S,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(m.Item,{name:"startDate",label:"开始时间",rules:[{required:!0,message:"请选择开始时间"}],children:e.jsx(W,{style:{width:"100%"}})})}),e.jsx(f,{span:12,children:e.jsx(m.Item,{name:"endDate",label:"结束时间",children:e.jsx(W,{style:{width:"100%"}})})})]}),e.jsx(m.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(O,{children:[e.jsx(h,{onClick:()=>{E(!1),D(null),C.resetFields()},children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:de,children:b?"更新":"创建"})]})})]})}),e.jsx(he,{title:_?"编辑平台":"新建平台",open:De,onCancel:()=>{z(!1),T(null),I.resetFields()},footer:null,width:600,children:e.jsxs(m,{form:I,layout:"vertical",onFinish:Me,children:[e.jsx(m.Item,{name:"name",label:"平台名称",rules:[{required:!0,message:"请输入平台名称"}],children:e.jsx(x,{placeholder:"请输入平台名称"})}),e.jsx(m.Item,{name:"code",label:"平台代码",rules:[{required:!0,message:"请输入平台代码"}],children:e.jsx(x,{placeholder:"请输入平台代码"})}),e.jsx(m.Item,{name:"description",label:"平台描述",children:e.jsx(x.TextArea,{placeholder:"请输入平台描述",rows:3})}),e.jsx(m.Item,{name:"color",label:"平台颜色",initialValue:"#1890ff",rules:[{required:!0,message:"请选择平台颜色"},{pattern:/^#[0-9A-Fa-f]{6}$/,message:"请输入有效的颜色值，如 #1890ff"}],children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(qe,{presets:[{label:"推荐颜色",colors:["#ff0050","#07c160","#2932e1","#4285f4","#e6162d","#ff6900","#1890ff","#52c41a","#faad14","#f5222d","#722ed1","#13c2c2"]}]}),e.jsx(x,{placeholder:"请输入颜色值，如 #1890ff",maxLength:7})]})}),e.jsxs(S,{gutter:16,children:[e.jsx(f,{span:12,children:e.jsx(m.Item,{name:"sortOrder",label:"排序",initialValue:0,children:e.jsx(x,{type:"number",placeholder:"排序值，数字越小越靠前"})})}),e.jsx(f,{span:12,children:e.jsx(m.Item,{name:"isEnabled",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(He,{checkedChildren:"启用",unCheckedChildren:"禁用"})})})]}),e.jsx(m.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(O,{children:[e.jsx(h,{onClick:()=>{z(!1),T(null),I.resetFields()},children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:_?"更新":"创建"})]})})]})})]})};export{Rt as default};
