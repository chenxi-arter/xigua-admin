import{d as $,r as v,p as c,a as k,q as y,E as g,F as I,s as T,y as a,U,k as S,z as B,X as E,v as n,R as V,_ as x,S as z}from"./index-DM4dnG1b.js";import{T as D,a as F}from"./index-Bdvv2x98.js";import"./index-Bp8a0Lpd.js";import{N as G}from"./index-BIwTISzW.js";import{P}from"./index-CV5xPIvm.js";import{L as q}from"./index-DWgsCegt.js";import{E as A}from"./index-MvBKmnbi.js";import"./use-id-CDkYcp_5.js";import"./use-route-DAS5eWQp.js";import"./use-placeholder-Dg-A1Zhx.js";const X="/static/img/1.png",j={class:"msg-space"},H=["onClick"],J={class:"badge-box"},K={class:"item-medi"},O={class:"nickname"},Q={class:"info"},W={key:0},Y={key:1},Z={class:"time"},ee={class:"item-right"},te=["src"],se=$({__name:"MsgComp",props:{active:{}},setup(N){const d=v(!1),i=v(!1),m=v(!1),r=v([]),l=N,f=async()=>{let e="";l.active==0?e="/api/notifications/unread":l.active==1?e="/api/video/episode/my-unread-replies":l.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(r.value.length/20)+1;try{const o=await V.get(e,{params:{page:s,size:20}}),u=o.data.data.list||o.data.list;r.value.push(...u),u.length<20&&(i.value=!0)}catch(o){console.error(o)}},h=async()=>{await f(),i.value=!0},w=async()=>{r.value=[],i.value=!1,await f(),m.value=!1},b=e=>{const s=new Date(e),u=new Date().getTime()-s.getTime(),C=Math.floor(u/1e3),_=Math.floor(C/60),t=Math.floor(_/60),R=Math.floor(t/24);return R>0?`${R}天前`:t>0?`${t}小时前`:_>0?`${_}分钟前`:"刚刚"},M=async e=>{const s="/api/video/episode/replies/mark-read";try{await V.post(s,{replyIds:[e]})}catch(o){console.error(o)}},p=async e=>{const s="/api/video/comment/likes/mark-read";try{await V.post(s,{replyIds:[e]})}catch(o){console.error(o)}},L=async e=>{l.active==1||e.type=="reply"?await M(e.id):(l.active==2||e.type=="like")&&await p(e.id),e.isRead=!0,E.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const o=A,u=S,C=q,_=P;return n(),c("div",j,[k(_,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),onRefresh:w},{default:y(()=>[r.value.length==0?(n(),g(o,{key:0,"image-size":"100",description:"暂无内容"})):(n(),g(C,{key:1,loading:d.value,"onUpdate:loading":s[0]||(s[0]=t=>d.value=t),finished:i.value,"finished-text":"没有更多了",onLoad:h},{default:y(()=>[(n(!0),c(I,null,T(r.value,t=>(n(),c("div",{class:"msg-item",key:t.id,onClick:R=>L(t)},[a("div",J,[t.isRead?U("",!0):(n(),g(u,{key:0,dot:""}))]),s[4]||(s[4]=a("div",{class:"item-left"},[a("img",{src:X,alt:""})],-1)),a("div",K,[a("div",O,B(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),a("div",Q,[e.active==1||t.type=="reply"?(n(),c("div",W,[s[2]||(s[2]=a("span",null,"评论了你:",-1)),a("span",null,B(t.content),1)])):e.active==2||t.type=="like"?(n(),c("div",Y,s[3]||(s[3]=[a("span",null,"点赞了你的评论",-1)]))):U("",!0),a("span",Z,B(b(t.createdAt)),1)])]),a("div",ee,[a("img",{src:t.seriesCoverUrl,alt:""},null,8,te)])],8,H))),128))]),_:1},8,["loading","finished"]))]),_:1},8,["modelValue"])])}}}),ae=x(se,[["__scopeId","data-v-8878d162"]]),oe=$({__name:"MessageView",setup(N){const d=z(),i=v(0),m=v(["全部","评论","点赞"]),r=()=>{l()},l=()=>{d.options.history.state?.back!==null?d.back():d.push("/")};return(f,h)=>{const w=G,b=F,M=D;return n(),c("div",null,[k(w,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:r}),k(M,{active:i.value,"onUpdate:active":h[0]||(h[0]=p=>i.value=p),shrink:"","line-width":"3vw",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:y(()=>[(n(!0),c(I,null,T(m.value,p=>(n(),g(b,{title:p,key:p},{default:y(()=>[k(ae,{active:i.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),_e=x(oe,[["__scopeId","data-v-9b6106ca"]]);export{_e as default};
