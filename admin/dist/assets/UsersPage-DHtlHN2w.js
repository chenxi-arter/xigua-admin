import{j as e}from"./index-BLY2COp8.js";import{r as a}from"./react-vendor-BZ8KDC-J.js";import{U as d}from"./admin-c-2Ny3Fo.js";import{f as _}from"./format-0Cj3JWJt.js";import{F as r,i as T,a as D,B as h,s as i,d as Q,f as I,I as p}from"./antd-vendor-CCOR70di.js";import"./utils-vendor-NIGUFBhG.js";function ae(){const[E,b]=a.useState(!1),[O,v]=a.useState([]),[F,L]=a.useState(0),[w,N]=a.useState(1),[f,P]=a.useState(10),[z,o]=a.useState(!1),[c,S]=a.useState(null),[u]=r.useForm(),[M,j]=a.useState(!1),[m,g]=a.useState(null),[V,y]=a.useState(!1),[x,C]=a.useState(null),l=a.useCallback(async(t=w,s=f)=>{b(!0);try{const n=await d.list(t,s);v(n.items),L(n.total),N(n.page),P(n.size)}finally{b(!1)}},[]);a.useEffect(()=>{l(1,f)},[]);const A=async(t,s)=>{try{await d.update(t.id,{is_active:s}),v(n=>n.map(k=>k.id===t.id?{...k,is_active:s}:k)),i.success(s?"已激活":"已禁用")}catch{i.error("更新失败")}},U=a.useMemo(()=>[{title:"ID",dataIndex:"id",width:160},{title:"用户名",dataIndex:"username",width:160,render:t=>e.jsx("span",{className:"text-ellipsis",style:{display:"inline-block",maxWidth:160},children:t})},{title:"姓名",width:140,render:(t,s)=>e.jsx("span",{className:"text-ellipsis",style:{display:"inline-block",maxWidth:140},children:(s.first_name||"")+" "+(s.last_name||"")})},{title:"激活",dataIndex:"is_active",width:100,render:(t,s)=>e.jsx(T,{checked:!!s.is_active,onChange:n=>A(s,n)})},{title:"创建时间",dataIndex:"created_at",width:200,render:t=>_(t)},{title:"最近登录",dataIndex:"lastLoginAt",width:200,render:t=>_(t)},{title:"登录IP",dataIndex:"lastLoginIp",width:140},{title:"登录设备",dataIndex:"lastLoginDevice",width:200,render:t=>e.jsx("span",{className:"text-ellipsis",style:{display:"inline-block",maxWidth:200},children:t||"-"})},{title:"在线数",dataIndex:"activeLogins",width:100},{title:"操作",width:220,render:(t,s)=>e.jsxs(D,{children:[e.jsx(h,{onClick:()=>q(s),type:"link",children:"编辑"}),e.jsx(h,{onClick:()=>B(s),danger:!0,type:"link",children:"删除"})]})}],[]),W=()=>{S(null),u.resetFields(),o(!0)},q=t=>{S(t),u.setFieldsValue(t),o(!0)},B=a.useCallback(t=>{g(t),j(!0)},[]),K=a.useCallback(async()=>{if(m)try{await d.remove(m.id),i.success("已删除"),l()}catch{i.error("删除失败")}finally{j(!1),g(null)}},[m,l]),R=a.useCallback(()=>{j(!1),g(null)},[]),G=a.useCallback(async()=>{if(!(!c||!x))try{await d.update(c.id,x),i.success("已更新"),o(!1),l()}catch{i.error("修改失败")}finally{y(!1),C(null)}},[c,x,l]),H=a.useCallback(()=>{y(!1),C(null)},[]),J=async()=>{const t=await u.validateFields();if(c)C(t),y(!0);else try{await d.create(t),i.success("已创建"),o(!1),l()}catch{i.error("创建失败")}};return e.jsxs("div",{className:"page",children:[e.jsxs(D,{className:"page-toolbar",children:[e.jsx(h,{type:"primary",onClick:W,children:"新建用户"}),e.jsx(h,{onClick:()=>l(),children:"刷新"})]}),e.jsx(Q,{rowKey:"id",loading:E,dataSource:O,columns:U,scroll:{x:1e3},tableLayout:"fixed",pagination:{current:w,pageSize:f,total:F,position:["bottomCenter"],onChange:(t,s)=>l(t,s)}}),e.jsx(I,{title:c?"编辑用户":"新建用户",open:z,onCancel:()=>o(!1),onOk:J,okText:"保存",children:e.jsxs(r,{form:u,layout:"vertical",children:[!c&&e.jsx(r.Item,{name:"id",label:"用户ID (bigint)",rules:[{required:!0}],children:e.jsx(p,{placeholder:"如 6702079700"})}),e.jsx(r.Item,{name:"username",label:"用户名",rules:[{required:!0}],children:e.jsx(p,{})}),e.jsx(r.Item,{name:"first_name",label:"名",children:e.jsx(p,{})}),e.jsx(r.Item,{name:"last_name",label:"姓",children:e.jsx(p,{})}),e.jsx(r.Item,{name:"is_active",label:"激活",valuePropName:"checked",initialValue:!0,children:e.jsx(T,{})})]})}),e.jsx(I,{title:"确认删除",open:M,onOk:K,onCancel:R,okText:"确认删除",cancelText:"取消",okType:"danger",children:e.jsxs("p",{children:["确定要删除用户「",m?.username,"」吗？此操作不可撤销。"]})}),e.jsx(I,{title:"确认修改",open:V,onOk:G,onCancel:H,okText:"确认修改",cancelText:"取消",children:e.jsxs("p",{children:["确定要修改用户「",x?.username,"」吗？"]})})]})}export{ae as default};
