import{d as T,r as v,o as D,p as d,q as n,a as h,s as k,D as y,F as $,v as I,y as a,T as V,k as z,z as U,X as E,U as B,_ as S,N as P}from"./index-B5bK_e6X.js";import{a as F,T as G}from"./index-Db3OMyBt.js";import"./index-B7smQM9_.js";import{N as q}from"./index-C1j9_U0X.js";import{P as A}from"./index-BJooBtus.js";import{L as X}from"./index-hVoNqUOo.js";import{E as j}from"./index-DE2wHaxm.js";import"./use-id-Bbu2fwFq.js";import"./use-route-7R4tdDFL.js";import"./use-placeholder-D_9lb61i.js";const H={class:"msg-space"},J=["onClick"],K={class:"badge-box"},O={class:"item-left"},Q=["src"],W={class:"item-medi"},Y={class:"nickname"},Z={class:"info"},ee={key:0},te={key:1},se={class:"time"},ae={class:"item-right"},oe=["src"],ne=T({__name:"MsgComp",props:{active:{}},setup(R){const r=v(!1),i=v(!1),_=v(!1),l=v([]),c=R,g=async()=>{let e="";c.active==0?e="/api/notifications/unread":c.active==1?e="/api/video/episode/my-unread-replies":c.active==2&&(e="/api/video/comment/my-unread-likes");const s=Math.floor(l.value.length/20)+1;try{const o=await B.get(e,{params:{page:s,size:20}}),p=o.data.data.list||o.data.list;l.value.push(...p),p.length<20&&(i.value=!0)}catch(o){console.error(o)}},f=async()=>{await g(),r.value=!1},w=async()=>{l.value=[],i.value=!1,r.value=!0,await f(),_.value=!1},b=e=>{const s=new Date(e),p=new Date().getTime()-s.getTime(),C=Math.floor(p/1e3),m=Math.floor(C/60),t=Math.floor(m/60),N=Math.floor(t/24);return N>0?`${N}天前`:t>0?`${t}小时前`:m>0?`${m}分钟前`:"刚刚"},M=async e=>{const s="/api/video/episode/replies/mark-read";try{await B.post(s,{replyIds:[e]})}catch(o){console.error(o)}},u=async e=>{const s="/api/video/comment/likes/mark-read";try{await B.post(s,{replyIds:[e]})}catch(o){console.error(o)}},x=D(),L=async e=>{c.active==1||e.type=="reply"?await M(e.id):(c.active==2||e.type=="like")&&await u(e.id),e.isRead=!0,x.fetchUnread(),E.push(`/series/${e.seriesShortId}?eid=${e.episodeShortId}&cmtShow=true`)};return(e,s)=>{const o=j,p=z,C=X,m=A;return n(),d("div",H,[h(m,{modelValue:_.value,"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),onRefresh:w},{default:k(()=>[i.value&&l.value.length==0?(n(),y(o,{key:0,"image-size":"100",description:"暂无内容"})):(n(),y(C,{key:1,loading:r.value,"onUpdate:loading":s[0]||(s[0]=t=>r.value=t),finished:i.value,"finished-text":"没有更多了",onLoad:f},{default:k(()=>[(n(!0),d($,null,I(l.value,t=>(n(),d("div",{class:"msg-item",key:t.id,onClick:N=>L(t)},[a("div",K,[t.isRead?V("",!0):(n(),y(p,{key:0,dot:""}))]),a("div",O,[a("img",{src:t.fromPhotoUrl,alt:""},null,8,Q)]),a("div",W,[a("div",Y,U(t.fromNickname||t.fromUsername||t.likerNickname||t.likerUsername),1),a("div",Z,[e.active==1||t.type=="reply"?(n(),d("div",ee,[s[2]||(s[2]=a("span",null,"评论了你:",-1)),a("span",null,U(t.content),1)])):e.active==2||t.type=="like"?(n(),d("div",te,s[3]||(s[3]=[a("span",null,"点赞了你的评论",-1)]))):V("",!0),a("span",se,U(b(t.createdAt)),1)])]),a("div",ae,[a("img",{src:t.seriesCoverUrl,alt:""},null,8,oe)])],8,J))),128))]),_:1},8,["loading","finished"]))]),_:1},8,["modelValue"])])}}}),re=S(ne,[["__scopeId","data-v-d9bef0d0"]]),ie=T({__name:"MessageView",setup(R){const r=P(),i=v(0),_=v(["全部","评论","点赞"]),l=()=>{c()},c=()=>{r.options.history.state?.back!==null?r.back():r.push("/")};return(g,f)=>{const w=q,b=F,M=G;return n(),d("div",null,[h(w,{class:"msg-nav",title:"我的消息","left-arrow":"",onClickLeft:l}),h(M,{active:i.value,"onUpdate:active":f[0]||(f[0]=u=>i.value=u),shrink:"","line-width":"0.3rem",background:"#1c1c1d","title-inactive-color":"white","title-active-color":"white"},{default:k(()=>[(n(!0),d($,null,I(_.value,u=>(n(),y(b,{title:u,key:u},{default:k(()=>[h(re,{active:i.value},null,8,["active"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])])}}}),ye=S(ie,[["__scopeId","data-v-35c42910"]]);export{ye as default};
